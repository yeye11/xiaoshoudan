# æœåŠ¡ç«¯å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ é¡¹ç›®åˆå§‹åŒ–

### 1. åˆ›å»ºé¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir cypridina-server
cd cypridina-server

# åˆå§‹åŒ– Node.js é¡¹ç›®
npm init -y

# å®‰è£… TypeScript
npm install -D typescript ts-node @types/node

# åˆå§‹åŒ– TypeScript
npx tsc --init
```

### 2. å®‰è£…æ ¸å¿ƒä¾èµ–

```bash
# Express æ¡†æ¶
npm install express cors helmet dotenv

# æ•°æ®åº“
npm install pg prisma @prisma/client

# è®¤è¯
npm install jsonwebtoken bcryptjs

# éªŒè¯
npm install joi

# æ—¥å¿—
npm install winston

# å·¥å…·
npm install uuid axios

# å¼€å‘ä¾èµ–
npm install -D nodemon @types/express @types/jsonwebtoken
```

### 3. é¡¹ç›®ç»“æ„

```
cypridina-server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.ts
â”‚   â”‚   â”œâ”€â”€ env.ts
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å±‚
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ sales.controller.ts
â”‚   â”‚   â”œâ”€â”€ customers.controller.ts
â”‚   â”‚   â””â”€â”€ products.controller.ts
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ sales.service.ts
â”‚   â”‚   â”œâ”€â”€ customers.service.ts
â”‚   â”‚   â””â”€â”€ products.service.ts
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ prisma.ts
â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”‚   â”œâ”€â”€ error.middleware.ts
â”‚   â”‚   â””â”€â”€ logger.middleware.ts
â”‚   â”œâ”€â”€ routes/           # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.routes.ts
â”‚   â”‚   â”œâ”€â”€ sales.routes.ts
â”‚   â”‚   â”œâ”€â”€ customers.routes.ts
â”‚   â”‚   â””â”€â”€ products.routes.ts
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ response.ts
â”‚   â”‚   â”œâ”€â”€ validators.ts
â”‚   â”‚   â””â”€â”€ helpers.ts
â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ app.ts            # åº”ç”¨å…¥å£
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma     # æ•°æ®åº“ schema
â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

---

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶ç¤ºä¾‹

### 1. .env æ–‡ä»¶

```env
# æœåŠ¡å™¨
NODE_ENV=development
PORT=3000
API_URL=http://localhost:3000

# æ•°æ®åº“
DATABASE_URL=postgresql://user:password@localhost:5432/cypridina

# JWT
JWT_SECRET=your-secret-key-here
JWT_REFRESH_SECRET=your-refresh-secret-key-here
JWT_EXPIRES_IN=3600
JWT_REFRESH_EXPIRES_IN=604800

# æ—¥å¿—
LOG_LEVEL=debug

# CORS
CORS_ORIGIN=http://localhost:5173,tauri://localhost
```

### 2. src/app.ts

```typescript
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import dotenv from 'dotenv';

import authRoutes from './routes/auth.routes';
import salesRoutes from './routes/sales.routes';
import customersRoutes from './routes/customers.routes';
import productsRoutes from './routes/products.routes';

import { errorHandler } from './middleware/error.middleware';
import { logger } from './middleware/logger.middleware';

dotenv.config();

const app = express();

// ä¸­é—´ä»¶
app.use(helmet());
app.use(cors({
  origin: process.env.CORS_ORIGIN?.split(','),
  credentials: true
}));
app.use(express.json());
app.use(logger);

// è·¯ç”±
app.use('/api/v1/auth', authRoutes);
app.use('/api/v1/sales', salesRoutes);
app.use('/api/v1/customers', customersRoutes);
app.use('/api/v1/products', productsRoutes);

// å¥åº·æ£€æŸ¥
app.get('/health', (req, res) => {
  res.json({ status: 'ok' });
});

// é”™è¯¯å¤„ç†
app.use(errorHandler);

export default app;
```

### 3. src/middleware/auth.middleware.ts

```typescript
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';

export interface AuthRequest extends Request {
  user?: {
    id: string;
    email: string;
    role: string;
  };
}

export const authMiddleware = (
  req: AuthRequest,
  res: Response,
  next: NextFunction
) => {
  const token = req.headers.authorization?.split(' ')[1];

  if (!token) {
    return res.status(401).json({
      code: 401,
      message: 'æœªæˆæƒ'
    });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET!);
    req.user = decoded as any;
    next();
  } catch (error) {
    res.status(401).json({
      code: 401,
      message: 'Token æ— æ•ˆæˆ–å·²è¿‡æœŸ'
    });
  }
};
```

### 4. src/utils/response.ts

```typescript
export interface ApiResponse<T = any> {
  code: number;
  message: string;
  data?: T;
  errors?: any[];
}

export const successResponse = <T>(
  data: T,
  message: string = 'æˆåŠŸ'
): ApiResponse<T> => ({
  code: 0,
  message,
  data
});

export const errorResponse = (
  code: number,
  message: string,
  errors?: any[]
): ApiResponse => ({
  code,
  message,
  errors
});
```

---

## ğŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–

### 1. åˆ›å»º Prisma Schema

```bash
npx prisma init
```

### 2. é…ç½® .env

```env
DATABASE_URL="postgresql://user:password@localhost:5432/cypridina"
```

### 3. åˆ›å»ºè¿ç§»

```bash
npx prisma migrate dev --name init
```

### 4. ç”Ÿæˆ Prisma Client

```bash
npx prisma generate
```

---

## ğŸƒ è¿è¡Œé¡¹ç›®

### å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…ä¾èµ–
npm install

# è¿è¡Œè¿ç§»
npx prisma migrate dev

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# æ„å»º
npm run build

# å¯åŠ¨
npm start
```

### package.json è„šæœ¬

```json
{
  "scripts": {
    "dev": "nodemon --exec ts-node src/app.ts",
    "build": "tsc",
    "start": "node dist/app.js",
    "db:migrate": "prisma migrate dev",
    "db:push": "prisma db push",
    "db:seed": "ts-node prisma/seed.ts",
    "db:studio": "prisma studio"
  }
}
```

---

## ğŸ§ª æµ‹è¯• API

### ä½¿ç”¨ curl

```bash
# æ³¨å†Œ
curl -X POST http://localhost:3000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123",
    "name": "å¼ ä¸‰"
  }'

# ç™»å½•
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }'

# è·å–é”€å”®å•åˆ—è¡¨
curl -X GET http://localhost:3000/api/v1/sales/invoices \
  -H "Authorization: Bearer {token}"
```

### ä½¿ç”¨ Postman

1. å¯¼å…¥ API é›†åˆ
2. è®¾ç½®ç¯å¢ƒå˜é‡ (token, baseUrl)
3. è¿è¡Œè¯·æ±‚

---

## ğŸ³ Docker éƒ¨ç½²

### Dockerfile

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY dist ./dist

EXPOSE 3000

CMD ["node", "dist/app.js"]
```

### docker-compose.yml

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: cypridina
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  api:
    build: .
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: postgresql://user:password@postgres:5432/cypridina
      JWT_SECRET: your-secret-key
    depends_on:
      - postgres

volumes:
  postgres_data:
```

### å¯åŠ¨

```bash
docker-compose up -d
```

---

## ğŸ“š ä¸‹ä¸€æ­¥

1. âœ… å®Œæˆé¡¹ç›®åˆå§‹åŒ–
2. âœ… å®ç°è®¤è¯ç³»ç»Ÿ
3. âœ… å®ç°é”€å”®å• CRUD
4. âœ… å®ç°å®¢æˆ·ç®¡ç†
5. âœ… å®ç°äº§å“ç®¡ç†
6. âœ… æ·»åŠ æŠ¥è¡¨åŠŸèƒ½
7. âœ… éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

## ğŸ”— æœ‰ç”¨çš„èµ„æº

- Express.js: https://expressjs.com/
- Prisma: https://www.prisma.io/
- PostgreSQL: https://www.postgresql.org/
- JWT: https://jwt.io/
- TypeScript: https://www.typescriptlang.org/

