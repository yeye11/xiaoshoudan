# 📱 移动端打印调试指南

## 🔍 调试步骤

### 1. 在手机上访问应用
- 确保手机和电脑在同一网络
- 在手机浏览器中访问：`http://[你的电脑IP]:1420/mobile`
- 或使用 Tauri 应用

### 2. 打开销售单详情页面
- 进入任意销售单详情页面
- 向下滚动到底部

### 3. 查看调试信息
- 点击 **🔍 调试信息** 展开调试面板
- 检查以下信息：
  - ✅ `invoiceContainer`: 应该显示"存在"
  - ✅ `contentRef`: 应该显示"存在"
  - ✅ `viewportRef`: 应该显示"存在"
  - 记录 `scale` 值
  - 记录 `window.innerWidth` 值

### 4. 测试打印功能
- 点击 **打印/保存PDF** 按钮
- 观察是否有弹窗或错误提示

### 5. 查看控制台日志（重要！）

#### 在手机 Safari 上查看控制台：
1. 在 Mac 上打开 Safari
2. 菜单栏 → 开发 → [你的iPhone名称] → 选择页面
3. 点击打印按钮后，查看控制台输出

#### 在手机 Chrome 上查看控制台：
1. 在电脑 Chrome 中访问 `chrome://inspect`
2. 找到你的手机设备
3. 点击 `inspect`
4. 点击打印按钮后，查看控制台输出

### 6. 记录控制台输出
查找以下日志：
```
🖨️ handlePrint 开始
📍 contentRef: ...
📍 invoiceContainer: ...
📍 viewportRef: ...
✅ 找到打印目标: ...
📏 目标尺寸: ...
📋 开始克隆目标元素...
🔧 移除 transform 样式...
✅ overlay 已添加到 body
🎨 添加打印样式类
🖨️ 调用 window.print()...
```

## 🐛 常见问题排查

### 问题1: 元素不存在
**症状**: 调试信息显示某个元素"不存在"
**解决**: 
- 刷新页面
- 等待页面完全加载后再点击打印
- 检查控制台是否有其他错误

### 问题2: window.print() 无响应
**症状**: 控制台显示"调用 window.print()"但没有打印对话框
**可能原因**:
- 移动浏览器可能不支持 `window.print()`
- 需要使用其他方案（如生成PDF或图片）

### 问题3: 打印内容为空
**症状**: 打印对话框出现，但预览是空白的
**解决**:
- 检查打印样式是否正确应用
- 查看控制台是否有CSS错误
- 检查 `#print-overlay` 是否正确创建

### 问题4: 打印内容被裁剪
**症状**: 打印预览中内容不完整
**解决**:
- 检查 `scale` 值是否正确
- 调整打印样式中的宽度和边距

## 📊 需要收集的信息

请在手机上测试后，提供以下信息：

1. **设备信息**:
   - 手机型号：
   - 操作系统版本：
   - 浏览器类型和版本：

2. **调试信息**:
   - invoiceContainer: 存在/不存在
   - contentRef: 存在/不存在
   - viewportRef: 存在/不存在
   - scale: 
   - window.innerWidth: 

3. **控制台日志**:
   - 复制完整的控制台输出（从"🖨️ handlePrint 开始"到最后）

4. **错误信息**:
   - 是否有弹窗提示？内容是什么？
   - 控制台是否有红色错误？

5. **实际表现**:
   - 点击打印按钮后发生了什么？
   - 是否出现打印对话框？
   - 打印预览是否正确？

## 🔧 临时解决方案

如果 `window.print()` 在移动端不工作，可以考虑：

### 方案A: 使用图片导出
- 已有的 `MobileImageExport` 组件
- 可以保存为图片后打印

### 方案B: 生成PDF
- 使用 jsPDF 库
- 直接生成PDF文件

### 方案C: 分享功能
- 使用 Web Share API
- 分享到其他应用后打印

## 📝 下一步

根据你提供的调试信息，我会：
1. 分析问题原因
2. 提供针对性的解决方案
3. 如果需要，实现替代方案

