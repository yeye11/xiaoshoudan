import"../chunks/Bzak7iHL.js";import{i as Le}from"../chunks/XlqFUZ3x.js";import{p as Ae,e as h,o as Ee,f as m,a as Fe,t as v,g as e,j as p,b,c as He,s as l,k as u,m as d,h as i,r as n,v as le,d as g}from"../chunks/nbkepknC.js";import{i as w}from"../chunks/BcVSc5tD.js";import{e as qe,i as Ge}from"../chunks/DVrF0WE5.js";import{r as C}from"../chunks/2WVzPzKa.js";import{s as S}from"../chunks/BYJuMw6P.js";import{b as f}from"../chunks/fLdq3W06.js";import{s as Ke,a as Qe}from"../chunks/D_8yISCJ.js";import{M as Re}from"../chunks/4cH0hlCX.js";import{c as Te}from"../chunks/D1IVDrhe.js";import{p as Ue}from"../chunks/CfvlGoBy.js";import{g as ie}from"../chunks/D9O0WCOO.js";var Ve=m('<div slot="actions"><button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors disabled:opacity-50" aria-label="保存"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button></div>'),We=m('<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-600 text-sm"> </p></div>'),Xe=m('<p class="text-red-500 text-sm mt-1"> </p>'),Ye=m('<p class="text-red-500 text-sm mt-1"> </p>'),Ze=m('<p class="text-red-500 text-sm mt-1"> </p>'),er=m('<p class="text-red-500 text-sm mt-1"> </p>'),rr=m("<button> </button>"),tr=m('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择客户分类</h3> <button class="text-gray-400 hover:text-gray-600" aria-label="关闭"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4"><div class="space-y-2"><!> <button class="w-full text-left p-3 rounded-lg border-2 border-dashed border-gray-300 text-gray-500 hover:border-blue-300 hover:text-blue-500 transition-colors">+ 添加新分类</button></div></div></div></div>'),ar=m('<!> <div class="p-4 space-y-6"><!> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">基本信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">客户名称 <span class="text-red-500">*</span></label> <input type="text" placeholder="请输入客户名称"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">客户分类</label> <button type="button" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-left bg-white"> </button></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">期初欠款</label> <input type="number" placeholder="请输入期初欠款" step="0.01" min="0"/> <!></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">联系信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">电话</label> <input type="tel" placeholder="请输入电话"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">备用电话</label> <input type="tel" placeholder="请输入备用电话" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">地址</label> <textarea placeholder="请输入地址" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">传真</label> <input type="text" placeholder="请输入传真" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">邮箱</label> <input type="email" placeholder="请输入邮箱"/> <!></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><label class="block text-sm font-medium text-gray-700 mb-1">备注</label> <textarea placeholder="请输入备注信息" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea></div> <div class="flex space-x-3 pb-6"><button type="button" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">取消</button> <button type="button" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50"> </button></div></div> <!>',1);function fr(ne,de){Ae(de,!1);const ce=()=>Qe(Ue,"$page",ue),[ue,be]=Ke();let t=h(Te()),s=h({}),x=h(!1),y=h(),_=h(["未分类","重要客户","普通客户","潜在客户"]),k=h(!1);Ee(()=>{u(y,ce().params.id),me(),ve()});const me=()=>{try{const r=localStorage.getItem("customers");if(r){const o=JSON.parse(r).find(c=>c.id===e(y));o?u(t,{...o}):d(s,e(s).general="客户不存在")}}catch(r){console.error("加载客户失败:",r),d(s,e(s).general="加载客户信息失败")}},ve=()=>{try{const r=localStorage.getItem("customer_categories");if(r){const a=JSON.parse(r);u(_,[...new Set([...e(_),...a])])}}catch(r){console.error("加载客户分类失败:",r)}},pe=()=>{try{localStorage.setItem("customer_categories",JSON.stringify(e(_)))}catch(r){console.error("保存客户分类失败:",r)}},ge=()=>(u(s,{}),e(t).name.trim()||d(s,e(s).name="客户名称不能为空"),e(t).phone.trim()&&!/^1[3-9]\d{9}$/.test(e(t).phone.replace(/[-\s]/g,""))&&d(s,e(s).phone="请输入有效的手机号码"),e(t).email&&e(t).email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e(t).email.trim())&&d(s,e(s).email="请输入有效的邮箱地址"),e(t).initialDebt<0&&d(s,e(s).initialDebt="期初欠款不能为负数"),Object.keys(e(s)).length===0),K=async()=>{if(ge()){u(x,!0);try{const r=localStorage.getItem("customers"),a=r?JSON.parse(r):[];if(a.some(c=>c.id!==e(y)&&c.name===e(t).name.trim())){d(s,e(s).name="客户名称已存在"),u(x,!1);return}d(t,e(t).name=e(t).name.trim()),d(t,e(t).updatedAt=new Date().toISOString());const o=a.findIndex(c=>c.id===e(y));o>=0?(a[o]=e(t),localStorage.setItem("customers",JSON.stringify(a)),ie(`/mobile/customers/${e(y)}`)):d(s,e(s).general="客户不存在")}catch(r){console.error("保存客户失败:",r),d(s,e(s).general="保存失败，请重试")}finally{u(x,!1)}}},fe=r=>{let o=r.target.value.replace(/\D/g,"");o.length>11&&(o=o.slice(0,11)),o.length>3&&o.length<=7?o=o.replace(/(\d{3})(\d+)/,"$1-$2"):o.length>7&&(o=o.replace(/(\d{3})(\d{4})(\d+)/,"$1-$2-$3")),d(t,e(t).phone=o)},xe=r=>{d(t,e(t).category=r),u(k,!1)},ye=()=>{const r=prompt("请输入新的客户分类:");if(r&&r.trim()){const a=r.trim();e(_).includes(a)||(e(_).push(a),pe(),d(t,e(t).category=a)),u(k,!1)}};Le();var Q=ar(),R=Fe(Q);Re(R,{title:"编辑客户",showBack:!0,backgroundColor:"bg-blue-500",$$slots:{actions:(r,a)=>{var o=Ve(),c=i(o);n(o),v(()=>c.disabled=e(x)),p("click",c,K),b(r,o)}}});var N=l(R,2),T=i(N);{var _e=r=>{var a=We(),o=i(a),c=i(o,!0);n(o),n(a),v(()=>g(c,e(s).general)),b(r,a)};w(T,r=>{e(s).general&&r(_e)})}var j=l(T,2),J=l(i(j),2),I=l(i(J),2);C(I);var he=l(I,2);{var we=r=>{var a=Xe(),o=i(a,!0);n(a),v(()=>g(o,e(s).name)),b(r,a)};w(he,r=>{e(s).name&&r(we)})}n(J);var P=l(J,2),z=l(i(P),2),ke=i(z,!0);n(z),n(P);var U=l(P,2),D=l(i(U),2);C(D);var $e=l(D,2);{var Ce=r=>{var a=Ye(),o=i(a,!0);n(a),v(()=>g(o,e(s).initialDebt)),b(r,a)};w($e,r=>{e(s).initialDebt&&r(Ce)})}n(U),n(j);var B=l(j,2),L=l(i(B),2),A=l(i(L),2),Se=l(A,2);{var Ie=r=>{var a=Ze(),o=i(a,!0);n(a),v(()=>g(o,e(s).phone)),b(r,a)};w(Se,r=>{e(s).phone&&r(Ie)})}n(L);var E=l(L,2),V=l(i(E),2);C(V),n(E);var F=l(E,2),W=l(i(F),2);le(W),n(F);var H=l(F,2),X=l(i(H),2);C(X),n(H);var Y=l(H,2),O=l(i(Y),2);C(O);var De=l(O,2);{var Oe=r=>{var a=er(),o=i(a,!0);n(a),v(()=>g(o,e(s).email)),b(r,a)};w(De,r=>{e(s).email&&r(Oe)})}n(Y),n(B);var q=l(B,2),Z=l(i(q),2);le(Z),n(q);var ee=l(q,2),re=i(ee),M=l(re,2),Me=i(M,!0);n(M),n(ee),n(N);var Ne=l(N,2);{var je=r=>{var a=tr(),o=i(a),c=i(o),te=i(c),Je=l(i(te),2);n(te),n(c);var ae=l(c,2),oe=i(ae),se=i(oe);qe(se,1,()=>e(_),Ge,(ze,G)=>{var $=rr(),Be=i($,!0);n($),v(()=>{S($,1,`w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors
                     ${e(t).category===e(G)?"bg-blue-50 text-blue-600 border border-blue-200":"border border-gray-200"}`),g(Be,e(G))}),p("click",$,()=>xe(e(G))),b(ze,$)});var Pe=l(se,2);n(oe),n(ae),n(o),n(a),p("click",Je,()=>u(k,!1)),p("click",Pe,ye),b(r,a)};w(Ne,r=>{e(k)&&r(je)})}v(()=>{S(I,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(s).name?"border-red-500":""}`),g(ke,e(t).category||"请选择客户分类"),S(D,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(s).initialDebt?"border-red-500":""}`),S(A,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(s).phone?"border-red-500":""}`),S(O,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(s).email?"border-red-500":""}`),M.disabled=e(x),g(Me,e(x)?"保存中...":"保存")}),f(I,()=>e(t).name,r=>d(t,e(t).name=r)),p("click",z,()=>u(k,!0)),f(D,()=>e(t).initialDebt,r=>d(t,e(t).initialDebt=r)),p("input",A,fe),f(V,()=>e(t).backupPhone,r=>d(t,e(t).backupPhone=r)),f(W,()=>e(t).address,r=>d(t,e(t).address=r)),f(X,()=>e(t).fax,r=>d(t,e(t).fax=r)),f(O,()=>e(t).email,r=>d(t,e(t).email=r)),f(Z,()=>e(t).notes,r=>d(t,e(t).notes=r)),p("click",re,()=>ie(`/mobile/customers/${e(y)}`)),p("click",M,K),b(ne,Q),He(),be()}export{fr as component};
