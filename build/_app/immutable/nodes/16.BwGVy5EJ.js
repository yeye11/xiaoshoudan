import"../chunks/Bzak7iHL.js";import{i as Ot}from"../chunks/BvNKmLqF.js";import{p as Vt,o as zt,l as Ht,u as Tt,f as p,a as Jt,t as N,b as m,c as Ft,g as t,m as B,e as S,i as d,w as n,j as i,k as v,d as F,r as o,s as l}from"../chunks/D2QV5ZPr.js";import{i as K}from"../chunks/BvOdW7jM.js";import{e as vt,i as ut}from"../chunks/IKNvqO1Y.js";import{r as Kt}from"../chunks/CdHOzu_t.js";import{s as mt}from"../chunks/Baws9BAC.js";import{b as Pt}from"../chunks/fy4Fdf6-.js";import{M as qt}from"../chunks/DO-NYQEs.js";import{g as pt}from"../chunks/BqcfPq16.js";var Et=p('<div slot="actions"><button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="创建销售单"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div>'),Gt=p("<button> </button>"),Qt=p('<div class="bg-white border-b border-gray-200 p-4 space-y-3"><div class="relative"><input type="text" placeholder="输入销售单号、客户名称、制单人" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"/> <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <button class="absolute right-3 top-2.5 text-red-500 font-medium">搜索</button></div> <div class="flex items-center space-x-2 overflow-x-auto"><span class="text-sm text-gray-600 whitespace-nowrap">状态:</span> <!></div> <div class="flex items-center space-x-2"><span class="text-sm text-gray-600">排序:</span> <button class="text-sm text-red-500 font-medium"> </button> <button class="text-sm text-red-500 font-medium"> </button> <button class="text-sm text-red-500 font-medium"> </button></div></div>'),Rt=p('<button class="bg-red-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors">创建第一个销售单</button>'),Ut=p('<div class="text-center py-12"><svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <p class="text-gray-500 mb-4"> </p> <!></div>'),Wt=p('<span class="text-red-600"> </span>'),Xt=p('<span class="text-green-600">已付款</span>'),Yt=p('<div class="bg-white rounded-lg p-4 shadow-sm border hover:shadow-md transition-shadow cursor-pointer"><div class="flex items-start justify-between mb-3"><div><h3 class="font-medium text-gray-900"> </h3> <p class="text-sm text-gray-600"> </p></div> <div class="text-right"><div class="text-lg font-bold text-gray-900"> </div> <div> </div></div></div> <div class="flex items-center justify-between text-sm text-gray-500"><div class="flex items-center space-x-4"><span> </span> <span> </span></div> <div class="flex items-center"><!></div></div></div>'),Zt=p('<div class="space-y-3"></div>'),te=p('<!> <!> <div class="p-4 bg-gray-50"><div class="grid grid-cols-2 gap-4"><div class="bg-white rounded-lg p-3 shadow-sm border"><div class="text-xs text-gray-500">今日销售</div> <div class="text-lg font-bold text-green-600"> </div></div> <div class="bg-white rounded-lg p-3 shadow-sm border"><div class="text-xs text-gray-500">未付金额</div> <div class="text-lg font-bold text-red-600"> </div></div></div></div> <div class="p-4"><!></div>',1);function ve(ft,gt){Vt(gt,!1);let b=[],C=B([]),Y=[],f=B(""),u=B("all"),L=B("date"),h=B("desc"),V=B(!1),c=B({totalSales:0,unpaidAmount:0,todaySales:0,invoiceCount:0});const P=[{id:"all",name:"全部",color:"text-gray-600"},{id:"draft",name:"草稿",color:"text-yellow-600"},{id:"sent",name:"已发送",color:"text-blue-600"},{id:"paid",name:"已付款",color:"text-green-600"},{id:"cancelled",name:"已取消",color:"text-red-600"}];zt(()=>{xt()});const xt=()=>{try{const e=localStorage.getItem("invoice_history");e&&(b=JSON.parse(e),v(C,b));const s=localStorage.getItem("customers");s&&(Y=JSON.parse(s)),_t(),z()}catch(e){console.error("加载数据失败:",e)}},_t=()=>{F(c,t(c).invoiceCount=b.length),F(c,t(c).totalSales=b.reduce((r,a)=>r+a.totalAmount,0)),F(c,t(c).unpaidAmount=b.filter(r=>r.paymentStatus!=="paid").reduce((r,a)=>r+(a.totalAmount-a.paidAmount),0));const e=new Date().toISOString().split("T")[0],s=b.filter(r=>r.date===e);F(c,t(c).todaySales=s.reduce((r,a)=>r+a.totalAmount,0))},bt=()=>{let e=b;if(t(f).trim()){const s=t(f).toLowerCase();e=e.filter(r=>r.invoiceNumber.toLowerCase().includes(s)||r.customerInfo.name.toLowerCase().includes(s)||r.createdBy.toLowerCase().includes(s))}t(u)!=="all"&&(e=e.filter(s=>s.status===t(u))),v(C,e),z()},z=()=>{t(C).sort((e,s)=>{let r,a;switch(t(L)){case"date":r=new Date(e.date).getTime(),a=new Date(s.date).getTime();break;case"amount":r=e.totalAmount,a=s.totalAmount;break;case"customer":r=e.customerInfo.name.toLowerCase(),a=s.customerInfo.name.toLowerCase();break;default:return 0}return typeof r=="string"?t(h)==="asc"?r.localeCompare(a):a.localeCompare(r):t(h)==="asc"?r-a:a-r})},Z=()=>{v(V,!t(V)),t(V)||(v(f,""),v(u,"all"),v(C,b),z())},q=e=>{t(L)===e?v(h,t(h)==="asc"?"desc":"asc"):(v(L,e),v(h,"desc")),z()},ht=e=>{if(e.customerId){const s=Y.find(r=>r.id===e.customerId);return s?s.name:e.customerInfo.name}return e.customerInfo.name},wt=e=>new Date(e).toLocaleDateString("zh-CN"),H=e=>`¥${e.toFixed(2)}`,tt=e=>P.find(r=>r.id===e.status)||P[0],E=()=>{pt("/mobile/sales/new")},yt=e=>{pt(`/mobile/sales/${e}`)};Ht(()=>(t(f),t(u)),()=>{(t(f)!==void 0||t(u)!==void 0)&&bt()}),Tt(),Ot();var et=te(),at=Jt(et);qt(at,{title:"销售",showBack:!0,showSearch:!0,showActions:!0,backgroundColor:"bg-red-500",$$events:{search:Z,action:E},$$slots:{actions:(e,s)=>{var r=Et(),a=d(r);o(r),S("click",a,E),m(e,r)}}});var rt=l(at,2);{var kt=e=>{var s=Qt(),r=d(s),a=d(r);Kt(a);var w=l(a,4);o(r);var g=l(r,2),x=l(d(g),2);vt(x,1,()=>P,ut,(A,$)=>{var y=Gt(),O=d(y,!0);o(y),N(()=>{mt(y,1,`px-3 py-1 rounded-full text-sm font-medium whitespace-nowrap transition-colors
                 ${t(u),t($),n(()=>t(u)===t($).id?"bg-red-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200")??""}`),i(O,(t($),n(()=>t($).name)))}),S("click",y,()=>v(u,t($).id)),m(A,y)}),o(g);var _=l(g,2),j=l(d(_),2),T=d(j);o(j);var M=l(j,2),J=d(M);o(M);var I=l(M,2),R=d(I);o(I),o(_),o(s),N(()=>{i(T,`日期 ${t(L)==="date"?t(h)==="asc"?"↑":"↓":""}`),i(J,`金额 ${t(L)==="amount"?t(h)==="asc"?"↑":"↓":""}`),i(R,`客户 ${t(L)==="customer"?t(h)==="asc"?"↑":"↓":""}`)}),Pt(a,()=>t(f),A=>v(f,A)),S("click",w,Z),S("click",j,()=>q("date")),S("click",M,()=>q("amount")),S("click",I,()=>q("customer")),m(e,s)};K(rt,e=>{t(V)&&e(kt)})}var G=l(rt,2),st=d(G),Q=d(st),ot=l(d(Q),2),St=d(ot,!0);o(ot),o(Q);var dt=l(Q,2),lt=l(d(dt),2),Ct=d(lt,!0);o(lt),o(dt),o(st),o(G);var nt=l(G,2),It=d(nt);{var At=e=>{var s=Ut(),r=l(d(s),2),a=d(r,!0);o(r);var w=l(r,2);{var g=x=>{var _=Rt();S("click",_,E),m(x,_)};K(w,x=>{!t(f)&&t(u)==="all"&&x(g)})}o(s),N(()=>i(a,t(f)||t(u)!=="all"?"暂时没有数据哦~":"还没有销售单")),m(e,s)},$t=e=>{var s=Zt();vt(s,5,()=>t(C),ut,(r,a)=>{var w=Yt(),g=d(w),x=d(g),_=d(x),j=d(_,!0);o(_);var T=l(_,2),M=d(T,!0);o(T),o(x);var J=l(x,2),I=d(J),R=d(I,!0);o(I);var A=l(I,2),$=d(A,!0);o(A),o(J),o(g);var y=l(g,2),O=d(y),U=d(O),Dt=d(U,!0);o(U);var it=l(U,2),Bt=d(it);o(it),o(O);var ct=l(O,2),Lt=d(ct);{var jt=k=>{var D=Wt(),W=d(D);o(D),N(X=>i(W,`未付: ${X??""}`),[()=>(t(a),n(()=>H(t(a).totalAmount-t(a).paidAmount)))]),m(k,D)},Mt=k=>{var D=Xt();m(k,D)};K(Lt,k=>{t(a),n(()=>t(a).paymentStatus!=="paid")?k(jt):k(Mt,!1)})}o(ct),o(y),o(w),N((k,D,W,X,Nt)=>{i(j,(t(a),n(()=>t(a).invoiceNumber))),i(M,k),i(R,D),mt(A,1,`text-xs ${W??""}`),i($,X),i(Dt,Nt),i(Bt,`制单人: ${t(a),n(()=>t(a).createdBy)??""}`)},[()=>(t(a),n(()=>ht(t(a)))),()=>(t(a),n(()=>H(t(a).totalAmount))),()=>(t(a),n(()=>tt(t(a)).color)),()=>(t(a),n(()=>tt(t(a)).name)),()=>(t(a),n(()=>wt(t(a).date)))]),S("click",w,()=>yt(t(a).id)),m(r,w)}),o(s),m(e,s)};K(It,e=>{t(C),n(()=>t(C).length===0)?e(At):e($t,!1)})}o(nt),N((e,s)=>{i(St,e),i(Ct,s)},[()=>(t(c),n(()=>H(t(c).todaySales))),()=>(t(c),n(()=>H(t(c).unpaidAmount)))]),m(ft,et),Ft()}export{ve as component};
