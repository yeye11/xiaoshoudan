import"../chunks/Bzak7iHL.js";import{i as ue}from"../chunks/XlqFUZ3x.js";import{F as ve,z as pe,a3 as ge,aF as fe,aG as be,aA as me,p as _e,e as N,o as xe,f as g,a as ye,t as w,g as t,j as u,b as p,c as he,h as n,s as i,m as v,k as x,r as s,n as Ct,v as we,d as D,C as T}from"../chunks/nbkepknC.js";import{i as B}from"../chunks/BcVSc5tD.js";import{e as U,i as q}from"../chunks/DVrF0WE5.js";import{r as H}from"../chunks/2WVzPzKa.js";import{s as L}from"../chunks/BYJuMw6P.js";import{b as A}from"../chunks/fLdq3W06.js";import{M as ke}from"../chunks/4cH0hlCX.js";import{f as Se,h as nt,i as lt}from"../chunks/D1IVDrhe.js";import{g as Dt}from"../chunks/Dk2bme3r.js";function Ot(c,y,r=!1){if(c.multiple){if(y==null)return;if(!ge(y))return fe();for(var l of c.options)l.selected=y.includes(E(l));return}for(l of c.options){var f=E(l);if(be(f,y)){l.selected=!0;return}}(!r||y!==void 0)&&(c.selectedIndex=-1)}function Me(c){var y=new MutationObserver(()=>{Ot(c,c.__value)});y.observe(c,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),me(()=>{y.disconnect()})}function je(c,y,r=y){var l=!0;ve(c,"change",f=>{var S=f?"[selected]":":checked",P;if(c.multiple)P=[].map.call(c.querySelectorAll(S),E);else{var M=c.querySelector(S)??c.querySelector("option:not([disabled])");P=M&&E(M)}r(P)}),pe(()=>{var f=y();if(Ot(c,f,l),l&&f===void 0){var S=c.querySelector(":checked");S!==null&&(f=E(S),r(f))}c.__value=f,l=!1}),Me(c)}function E(c){return"__value"in c?c.__value:c.value}var Ce=g('<div slot="actions"><button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors disabled:opacity-50" aria-label="保存"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button></div>'),De=g('<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-600 text-sm"> </p></div>'),Oe=g('<p class="text-red-500 text-sm mt-1"> </p>'),Be=g('<p class="text-red-500 text-sm mt-1"> </p>'),Pe=g('<p class="text-red-500 text-sm"> </p>'),$e=g('<button type="button" class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>'),Ie=g('<div class="flex items-center space-x-2"><input type="text" placeholder="如: 1220*2440" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/> <button type="button">默认</button> <!></div>'),Ne=g('<p class="text-red-500 text-sm"> </p>'),Le=g('<button type="button" class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>'),Je=g('<div class="flex items-center space-x-2"><select class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"><option>销售价</option><option>采购价</option><option>批发价</option></select> <input type="number" placeholder="0.00" step="0.01" min="0" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/> <button type="button">默认</button> <!></div>'),Ue=g('<span class="inline-flex items-center bg-gray-100 text-gray-700 text-sm px-3 py-1 rounded-full"> <button type="button" class="ml-2 text-gray-400 hover:text-gray-600"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></span>'),qe=g('<div class="flex flex-wrap gap-2"></div>'),Ae=g('<p class="text-gray-500 text-sm">暂无标签</p>'),Ee=g('<button class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors"> </button>'),ze=g('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择产品分类</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4 space-y-2"><!> <button class="w-full text-left p-3 rounded-lg text-orange-500 hover:bg-orange-50 transition-colors">+ 添加新分类</button></div></div></div>'),Fe=g('<button class="p-3 text-center rounded-lg hover:bg-gray-100 transition-colors border"> </button>'),Te=g('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择单位</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4 grid grid-cols-3 gap-2"><!> <button class="p-3 text-center rounded-lg text-orange-500 hover:bg-orange-50 transition-colors border border-orange-200">+ 新单位</button></div></div></div>'),He=g('<!> <div class="p-4 space-y-6"><!> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">基本信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">名称 <span class="text-red-500">*</span></label> <input type="text" placeholder="请输入产品名称"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">条形码</label> <div class="flex space-x-2"><input type="text" placeholder="请输入条形码" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/> <button type="button" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">生成</button></div></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">产品分类</label> <button type="button" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-left focus:ring-2 focus:ring-orange-500 focus:border-transparent flex items-center justify-between"><span> </span> <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">单位</label> <button type="button"><span> </span> <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">规格型号</h3> <button type="button" class="text-orange-500 text-sm font-medium">+ 添加</button></div> <!> <div class="space-y-3"></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">价格管理</h3> <div class="flex space-x-2"><button type="button" class="text-orange-500 text-sm font-medium">+ 销售价</button> <button type="button" class="text-orange-500 text-sm font-medium">+ 采购价</button></div></div> <!> <div class="space-y-3"></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">标签</h3> <button type="button" class="text-orange-500 text-sm font-medium">+ 添加</button></div> <!></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><label class="block text-sm font-medium text-gray-700 mb-1">备注</label> <textarea placeholder="请输入备注信息" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none"></textarea></div> <div class="flex space-x-3 pb-6"><button type="button" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">取消</button> <button type="button" class="flex-1 bg-orange-500 text-white py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors disabled:opacity-50"> </button></div></div> <!> <!>',1);function rr(c,y){_e(y,!1);let r=N(Se()),l=N({}),f=N(!1),S=N(!1),P=N(!1),M=N(["未分类","装饰材料","建筑材料","五金配件"]),$=N(["件","个","套","米","平方米","立方米","吨","公斤","盒","包"]);xe(()=>{Bt(),t(r).specifications.length===0&&t(r).specifications.push(nt()),t(r).prices.length===0&&t(r).prices.push(lt("sale"))});const Bt=()=>{try{const e=localStorage.getItem("product_categories");if(e){const o=JSON.parse(e);x(M,[...new Set([...t(M),...o])])}const a=localStorage.getItem("product_units");if(a){const o=JSON.parse(a);x($,[...new Set([...t($),...o])])}}catch(e){console.error("加载选项数据失败:",e)}},Pt=()=>{try{localStorage.setItem("product_categories",JSON.stringify(t(M))),localStorage.setItem("product_units",JSON.stringify(t($)))}catch(e){console.error("保存选项数据失败:",e)}},$t=()=>(x(l,{}),t(r).name.trim()||v(l,t(l).name="产品名称不能为空"),Object.keys(t(l)).length===0),ct=async()=>{if($t()){x(f,!0);try{v(r,t(r).name=t(r).name.trim()),v(r,t(r).specifications=t(r).specifications.filter(o=>o.name.trim())),v(r,t(r).prices=t(r).prices.filter(o=>o.price>0)),t(r).specifications.length===0?t(r).specifications.push({...nt(),name:"默认规格",isDefault:!0}):t(r).specifications.some(o=>o.isDefault)||v(r,t(r).specifications[0].isDefault=!0),t(r).prices.length===0?t(r).prices.push({...lt("sale"),price:0,isDefault:!0}):t(r).prices.some(o=>o.isDefault)||v(r,t(r).prices[0].isDefault=!0),t(r).unit.trim()||v(r,t(r).unit="件"),t(r).category.trim()||v(r,t(r).category="未分类");const e=localStorage.getItem("products"),a=e?JSON.parse(e):[];if(a.some(o=>o.name===t(r).name)){v(l,t(l).name="产品名称已存在"),x(f,!1);return}v(r,t(r).updatedAt=new Date().toISOString()),a.push(t(r)),localStorage.setItem("products",JSON.stringify(a)),t(r).category&&!t(M).includes(t(r).category)&&t(M).push(t(r).category),t(r).unit&&!t($).includes(t(r).unit)&&t($).push(t(r).unit),Pt(),Dt("/mobile/products")}catch(e){console.error("保存产品失败:",e),v(l,t(l).general="保存失败，请重试")}finally{x(f,!1)}}},It=e=>{v(r,t(r).category=e),x(S,!1)},Nt=e=>{v(r,t(r).unit=e),x(P,!1)},Lt=()=>{const e=prompt("请输入新的产品分类:");if(e&&e.trim()){const a=e.trim();t(M).includes(a)||t(M).push(a),v(r,t(r).category=a)}x(S,!1)},Jt=()=>{const e=prompt("请输入新的单位:");if(e&&e.trim()){const a=e.trim();t($).includes(a)||t($).push(a),v(r,t(r).unit=a)}x(P,!1)},Ut=()=>{t(r).specifications.push(nt())},qt=e=>{t(r).specifications.length>1&&t(r).specifications.splice(e,1)},At=e=>{t(r).specifications.forEach((a,o)=>{a.isDefault=o===e})},dt=(e="sale")=>{t(r).prices.push(lt(e))},Et=e=>{t(r).prices.length>1&&t(r).prices.splice(e,1)},zt=e=>{const a=t(r).prices[e].type;t(r).prices.forEach((o,d)=>{o.type===a&&(o.isDefault=d===e)})},Ft=()=>{const e=prompt("请输入标签:");e&&e.trim()&&!t(r).tags.includes(e.trim())&&t(r).tags.push(e.trim())},Tt=e=>{t(r).tags.splice(e,1)},Ht=()=>{const e=Date.now().toString(),a=Math.random().toString(36).substr(2,5);v(r,t(r).barcode=`${e.slice(-8)}${a}`.toUpperCase())};ue();var ut=He(),vt=ye(ut);ke(vt,{title:"新建产品",showBack:!0,backgroundColor:"bg-orange-500",$$slots:{actions:(e,a)=>{var o=Ce(),d=n(o);s(o),w(()=>d.disabled=t(f)),u("click",d,ct),p(e,o)}}});var V=i(vt,2),pt=n(V);{var Vt=e=>{var a=De(),o=n(a),d=n(o,!0);s(o),s(a),w(()=>D(d,t(l).general)),p(e,a)};B(pt,e=>{t(l).general&&e(Vt)})}var G=i(pt,2),K=i(n(G),2),z=i(n(K),2);H(z);var Gt=i(z,2);{var Kt=e=>{var a=Oe(),o=n(a,!0);s(a),w(()=>D(o,t(l).name)),p(e,a)};B(Gt,e=>{t(l).name&&e(Kt)})}s(K);var Q=i(K,2),gt=i(n(Q),2),R=n(gt);H(R);var Qt=i(R,2);s(gt),s(Q);var W=i(Q,2),X=i(n(W),2),Y=n(X),Rt=n(Y,!0);s(Y),Ct(2),s(X),s(W);var ft=i(W,2),J=i(n(ft),2),Z=n(J),Wt=n(Z,!0);s(Z),Ct(2),s(J);var Xt=i(J,2);{var Yt=e=>{var a=Be(),o=n(a,!0);s(a),w(()=>D(o,t(l).unit)),p(e,a)};B(Xt,e=>{t(l).unit&&e(Yt)})}s(ft),s(G);var tt=i(G,2),et=n(tt),Zt=i(n(et),2);s(et);var bt=i(et,2);{var te=e=>{var a=Pe(),o=n(a,!0);s(a),w(()=>D(o,t(l).specifications)),p(e,a)};B(bt,e=>{t(l).specifications&&e(te)})}var mt=i(bt,2);U(mt,5,()=>t(r).specifications,q,(e,a,o)=>{var d=Ie(),b=n(d);H(b);var m=i(b,2),_=i(m,2);{var k=h=>{var O=$e();u("click",O,()=>qt(o)),p(h,O)};B(_,h=>{t(r).specifications.length>1&&h(k)})}s(d),w(()=>L(m,1,`px-3 py-2 text-sm rounded-lg transition-colors
                   ${t(a).isDefault?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`)),A(b,()=>t(a).name,h=>(t(a).name=h,T(()=>t(r)))),u("click",m,()=>At(o)),p(e,d)}),s(mt),s(tt);var rt=i(tt,2),at=n(rt),_t=i(n(at),2),xt=n(_t),ee=i(xt,2);s(_t),s(at);var yt=i(at,2);{var re=e=>{var a=Ne(),o=n(a,!0);s(a),w(()=>D(o,t(l).prices)),p(e,a)};B(yt,e=>{t(l).prices&&e(re)})}var ht=i(yt,2);U(ht,5,()=>t(r).prices,q,(e,a,o)=>{var d=Je(),b=n(d);w(()=>{t(a),T(()=>{})});var m=n(b);m.value=m.__value="sale";var _=i(m);_.value=_.__value="purchase";var k=i(_);k.value=k.__value="wholesale",s(b);var h=i(b,2);H(h);var O=i(h,2),I=i(O,2);{var j=C=>{var jt=Le();u("click",jt,()=>Et(o)),p(C,jt)};B(I,C=>{t(r).prices.length>1&&C(j)})}s(d),w(()=>L(O,1,`px-3 py-2 text-sm rounded-lg transition-colors
                   ${t(a).isDefault?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`)),je(b,()=>t(a).type,C=>(t(a).type=C,T(()=>t(r)))),A(h,()=>t(a).price,C=>(t(a).price=C,T(()=>t(r)))),u("click",O,()=>zt(o)),p(e,d)}),s(ht),s(rt);var ot=i(rt,2),st=n(ot),ae=i(n(st),2);s(st);var oe=i(st,2);{var se=e=>{var a=qe();U(a,5,()=>t(r).tags,q,(o,d,b)=>{var m=Ue(),_=n(m),k=i(_);s(m),w(()=>D(_,`${t(d)??""} `)),u("click",k,()=>Tt(b)),p(o,m)}),s(a),p(e,a)},ie=e=>{var a=Ae();p(e,a)};B(oe,e=>{t(r).tags.length>0?e(se):e(ie,!1)})}s(ot);var it=i(ot,2),wt=i(n(it),2);we(wt),s(it);var kt=i(it,2),St=n(kt),F=i(St,2),ne=n(F,!0);s(F),s(kt),s(V);var Mt=i(V,2);{var le=e=>{var a=ze(),o=n(a),d=n(o),b=n(d),m=i(n(b),2);s(b),s(d);var _=i(d,2),k=n(_);U(k,1,()=>t(M),q,(O,I)=>{var j=Ee(),C=n(j,!0);s(j),w(()=>D(C,t(I))),u("click",j,()=>It(t(I))),p(O,j)});var h=i(k,2);s(_),s(o),s(a),u("click",m,()=>x(S,!1)),u("click",h,Lt),p(e,a)};B(Mt,e=>{t(S)&&e(le)})}var ce=i(Mt,2);{var de=e=>{var a=Te(),o=n(a),d=n(o),b=n(d),m=i(n(b),2);s(b),s(d);var _=i(d,2),k=n(_);U(k,1,()=>t($),q,(O,I)=>{var j=Fe(),C=n(j,!0);s(j),w(()=>D(C,t(I))),u("click",j,()=>Nt(t(I))),p(O,j)});var h=i(k,2);s(_),s(o),s(a),u("click",m,()=>x(P,!1)),u("click",h,Jt),p(e,a)};B(ce,e=>{t(P)&&e(de)})}w(()=>{L(z,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent
               ${t(l).name?"border-red-500":""}`),L(Y,1,t(r).category?"text-gray-900":"text-gray-500"),D(Rt,t(r).category||"请选择产品分类"),L(J,1,`w-full px-3 py-2 border border-gray-300 rounded-lg text-left focus:ring-2 focus:ring-orange-500 focus:border-transparent flex items-center justify-between
               ${t(l).unit?"border-red-500":""}`),L(Z,1,t(r).unit?"text-gray-900":"text-gray-500"),D(Wt,t(r).unit||"请选择单位"),F.disabled=t(f),D(ne,t(f)?"保存中...":"保存")}),A(z,()=>t(r).name,e=>v(r,t(r).name=e)),A(R,()=>t(r).barcode,e=>v(r,t(r).barcode=e)),u("click",Qt,Ht),u("click",X,()=>x(S,!0)),u("click",J,()=>x(P,!0)),u("click",Zt,Ut),u("click",xt,()=>dt("sale")),u("click",ee,()=>dt("purchase")),u("click",ae,Ft),A(wt,()=>t(r).notes,e=>v(r,t(r).notes=e)),u("click",St,()=>Dt("/mobile/products")),u("click",F,ct),p(c,ut),he()}export{rr as component};
