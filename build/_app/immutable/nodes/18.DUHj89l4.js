import"../chunks/Bzak7iHL.js";import{i as $t}from"../chunks/XlqFUZ3x.js";import{p as Pt,o as St,l as Ge,i as jt,f as p,a as Be,b as f,c as Bt,g as e,e as Q,t as k,j as $,h as a,k as j,m as g,r,s as i,u as v,d as _,C as Ke,v as Ct,q as Mt,D as Dt,E as Nt}from"../chunks/nbkepknC.js";import{i as w}from"../chunks/BcVSc5tD.js";import{e as pe,i as be}from"../chunks/DVrF0WE5.js";import{r as de}from"../chunks/2WVzPzKa.js";import{s as qt}from"../chunks/BYJuMw6P.js";import{b as re}from"../chunks/fLdq3W06.js";import{s as At,a as Ot}from"../chunks/D_8yISCJ.js";import{M as Lt}from"../chunks/4cH0hlCX.js";import{a as Ut,b as zt,d as Qe,e as Ft}from"../chunks/D1IVDrhe.js";import{g as Ht}from"../chunks/BCgAnOdk.js";import{p as Et}from"../chunks/C3OukU56.js";import{g as H}from"../chunks/Dk2bme3r.js";var Jt=p('<div slot="actions"><button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors disabled:opacity-50" aria-label="保存"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button></div>'),Rt=p('<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-600 text-sm font-medium"> </p></div>'),Vt=p("<li> </li>"),Tt=p('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3"><p class="text-yellow-800 text-sm font-medium mb-2">请检查以下问题：</p> <ul class="text-yellow-700 text-sm space-y-1"></ul></div>'),Gt=p('<div class="text-sm text-gray-600"> </div>'),Kt=p('<div class="text-sm text-gray-600"> </div>'),Qt=p('<div class="bg-gray-50 rounded-lg p-3"><div class="font-medium text-gray-900"> </div> <!> <!></div>'),Wt=p('<button class="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-red-300 hover:text-red-500 transition-colors">点击选择客户</button>'),Xt=p('<p class="text-red-500 text-sm"> </p>'),Yt=p('<p class="text-red-500 text-sm mt-1"> </p>'),Zt=p('<p class="text-red-500 text-sm"> </p>'),er=p('<span class="text-gray-600 ml-2"> </span>'),tr=p('<button class="p-1 text-red-500 hover:bg-red-50 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>'),rr=p('<div class="border border-gray-200 rounded-lg p-3"><div class="flex items-start justify-between mb-3"><div class="flex-1"><div class="text-sm"><span class="font-medium text-gray-900"> </span> <!> <span class="text-gray-600 ml-2"> </span></div></div> <div class="flex space-x-2"><button class="p-1 text-blue-500 hover:bg-blue-50 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button> <button class="p-1 text-green-500 hover:bg-green-50 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button> <!></div></div> <div class="grid grid-cols-3 gap-3"><div><label class="block text-xs text-gray-500 mb-1">数量</label> <input type="number" min="0" step="1" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-red-500 focus:border-transparent"/></div> <div><label class="block text-xs text-gray-500 mb-1">单价</label> <input type="number" min="0" step="0.01" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-red-500 focus:border-transparent"/></div> <div><label class="block text-xs text-gray-500 mb-1">金额</label> <div class="px-2 py-1 text-sm bg-gray-50 rounded font-medium"> </div></div></div></div>'),ar=p('<div class="text-center py-8"><p class="text-gray-500 mb-4">还没有客户数据</p> <button class="bg-blue-500 text-white px-4 py-2 rounded-lg font-medium">添加客户</button></div>'),sr=p('<div class="text-sm text-gray-600"> </div>'),or=p('<div class="text-xs text-blue-600"> </div>'),ir=p('<button class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors border"><div class="font-medium text-gray-900"> </div> <!> <!></button>'),nr=p('<div class="space-y-2"></div>'),dr=p('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择客户</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4"><!></div></div></div>'),lr=p('<div class="text-center py-8"><p class="text-gray-500 mb-4">还没有产品数据</p> <button class="bg-orange-500 text-white px-4 py-2 rounded-lg font-medium">添加产品</button></div>'),vr=p('<div class="text-xs text-orange-600"> </div>'),cr=p('<div class="text-xs text-gray-500"> </div>'),ur=p('<div class="text-sm font-medium text-orange-600"> </div>'),mr=p('<button class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors border"><div class="flex items-start justify-between"><div class="flex-1"><div class="font-medium text-gray-900"> </div> <!> <div class="text-sm text-gray-600"> </div> <!></div> <div class="text-right"><!></div></div></button>'),fr=p('<div class="space-y-2"></div>'),pr=p('<div class="mt-4"><div class="bg-white w-full rounded-lg shadow-sm border max-h-[60vh] overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择产品</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4"><!></div></div></div>'),br=p('<div class="p-4 space-y-6"><!> <!> <div class="hidden bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">客户信息</h3> <button class="text-red-500 text-sm font-medium"> </button></div> <!> <!></div> <div class="hidden bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">基本信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">日期</label> <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">制单人 <span class="text-red-500">*</span></label> <input type="text" placeholder="请输入制单人"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">送货日期</label> <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"/></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">商品明细</h3> <button class="text-red-500 text-sm font-medium">+ 添加商品</button></div> <!> <div class="space-y-3"></div> <div class="border-t border-gray-200 pt-3"><div class="flex justify-between items-center"><span class="font-medium text-gray-900">合计:</span> <span class="text-xl font-bold text-red-600"> </span></div></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><label class="block text-sm font-medium text-gray-700 mb-1">备注</label> <textarea placeholder="请输入备注信息" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none"></textarea></div> <div class="flex space-x-3 pb-6"><button type="button" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">取消</button> <button type="button" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors disabled:opacity-50"> </button></div></div> <!> <!>',1),gr=p("<!> <!>",1);function Dr(We,Xe){Pt(Xe,!1);const A=()=>Ot(Et,"$page",Ye),[Ye,Ze]=At();let t=Q(null),R=Q([]),W=Q([]),d=Q({}),ae=Q(!1),se=Q(!1),ge=Q(!1),X=Q(-1);const et={name:"佛山市仁腾装饰材料有限公司",address:"佛山市南海盐步大转弯夹板装饰第五期C1座12号",phone:"18575852698",email:"",taxId:""};St(()=>{tt(),rt()});const tt=()=>{try{const s=localStorage.getItem("customers");s&&j(R,JSON.parse(s));const n=localStorage.getItem("products");n&&j(W,JSON.parse(n))}catch(s){console.error("加载数据失败:",s)}},rt=()=>{j(t,Ut(et)),g(t,e(t).items=[]);const s=A().url.searchParams.get("customerId"),n=A().url.searchParams.get("createdBy");if(s){const u=e(R).find(b=>b.id===s);u&&_e(u)}n?g(t,e(t).createdBy=decodeURIComponent(n)):g(t,e(t).createdBy=Ht())},_e=s=>{e(t)&&(g(t,e(t).customerId=s.id),g(t,e(t).customerInfo={name:s.name,address:s.address||"",phone:s.phone,email:s.email||""}),j(se,!1))},Ce=s=>{if(e(t)){if(e(X)>=0){const n=e(t).items[e(X)];n.productId=s.id,n.productName=s.name;const u=s.specifications.find(y=>y.isDefault);n.specification=u?u.name:"";const b=s.prices.find(y=>y.type==="sale"&&y.isDefault);n.unitPrice=b?b.price:0,n.unit=s.unit,xe(e(X))}else{const n=zt();n.productId=s.id,n.productName=s.name;const u=s.specifications.find(y=>y.isDefault);n.specification=u?u.name:"";const b=s.prices.find(y=>y.type==="sale"&&y.isDefault);n.unitPrice=b?b.price:0,n.unit=s.unit,n.amount=Qe(n.quantity,n.unitPrice),e(t).items.push(n)}j(ge,!1),j(X,-1),le()}},xe=s=>{if(!e(t))return;const n=e(t).items[s];n.amount=Qe(n.quantity,n.unitPrice),le()},le=()=>{e(t)&&g(t,e(t).totalAmount=Ft(e(t).items))},at=()=>{var n;j(X,-1);const s=(n=e(t))==null?void 0:n.customerId;H(`/mobile/products/select?index=-1${s?`&customerId=${s}`:""}`)},st=s=>{var u;j(X,s);const n=(u=e(t))==null?void 0:u.customerId;H(`/mobile/products/select?index=${s}${n?`&customerId=${n}`:""}`)},ot=s=>{e(t)&&e(t).items.length>1&&(e(t).items.splice(s,1),le())},it=s=>{if(!e(t))return;const u={...e(t).items[s],id:crypto.randomUUID()};e(t).items.splice(s+1,0,u),le()},nt=()=>{var s,n,u;return e(t)?(j(d,{}),(n=(s=e(t).customerInfo)==null?void 0:s.name)!=null&&n.trim()||g(d,e(d).customer="请选择客户"),(u=e(t).createdBy)!=null&&u.trim()||g(d,e(d).createdBy="制单人不能为空"),e(t).items.length===0&&g(d,e(d).items="至少需要一个商品项目"),e(t).items.forEach((b,y)=>{b.productName.trim()||g(d,e(d)[`item_${y}_name`]="商品名称不能为空"),b.quantity<=0&&g(d,e(d)[`item_${y}_quantity`]="数量必须大于0"),b.unitPrice<0&&g(d,e(d)[`item_${y}_price`]="单价不能为负数")}),Object.keys(e(d)).length===0):!1},Me=async(s="draft")=>{if(console.log("开始保存销售单...",{invoice:e(t),status:s}),!e(t)){console.error("保存失败：invoice 为空"),g(d,e(d).general="销售单数据未初始化");return}const n=nt();if(console.log("表单验证结果:",{isValid:n,errors:e(d)}),!n){console.error("保存失败：表单验证未通过",e(d)),g(d,e(d).general="请检查并填写所有必填字段");return}j(ae,!0);try{g(t,e(t).status=s),g(t,e(t).type="sale"),g(t,e(t).paymentStatus="unpaid"),g(t,e(t).paidAmount=0);const u=localStorage.getItem("invoice_history"),b=u?JSON.parse(u):[];b.push(e(t)),localStorage.setItem("invoice_history",JSON.stringify(b)),H("/mobile/sales")}catch(u){console.error("保存销售单失败:",u),g(d,e(d).general="保存失败，请重试")}finally{j(ae,!1)}},De=s=>`¥${s.toFixed(2)}`;Ge(()=>(e(t),e(R),A(),H),()=>{var s;if(e(t)&&e(R).length>0&&((s=A())!=null&&s.url)){const n=A().url.searchParams.get("customerId");if(n&&!e(t).customerId){const u=e(R).find(b=>b.id===n);if(u){_e(u);const b=new URLSearchParams(A().url.search);b.delete("customerId");const y=b.toString();H(`${A().url.pathname}${y?"?"+y:""}`,{replaceState:!0,noScroll:!0,keepFocus:!0})}}}}),Ge(()=>(A(),e(W),e(t),H),()=>{var s;if((s=A())!=null&&s.url&&e(W).length>0&&e(t)){const n=A().url.searchParams,u=n.get("pickProductId");if(u){const b=parseInt(n.get("index")||"-1",10);j(X,isNaN(b)?-1:b);const y=e(W).find(oe=>oe.id===u);y&&Ce(y);const ee=new URLSearchParams(A().url.search);ee.delete("pickProductId"),ee.delete("index");const ve=ee.toString();H(`${A().url.pathname}${ve?"?"+ve:""}`,{replaceState:!0,noScroll:!0,keepFocus:!0})}}}),jt(),$t();var Ne=gr(),qe=Be(Ne);Lt(qe,{title:"新建销售单",showBack:!0,backgroundColor:"bg-red-500",$$slots:{actions:(s,n)=>{var u=Jt(),b=a(u);r(u),k(()=>b.disabled=e(ae)),$("click",b,()=>Me("draft")),f(s,u)}}});var dt=i(qe,2);{var lt=s=>{var n=br(),u=Be(n),b=a(u);{var y=l=>{var o=Rt(),m=a(o),I=a(m,!0);r(m),r(o),k(()=>_(I,(e(d),v(()=>e(d).general)))),f(l,o)};w(b,l=>{e(d),v(()=>e(d).general)&&l(y)})}var ee=i(b,2);{var ve=l=>{var o=Tt(),m=i(a(o),2);pe(m,5,()=>(e(d),v(()=>Object.entries(e(d)))),be,(I,M)=>{var O=Dt(()=>Nt(e(M),2));let L=()=>e(O)[0],z=()=>e(O)[1];var P=Mt(),S=Be(P);{var h=x=>{var D=Vt(),c=a(D);r(D),k(()=>_(c,`• ${z()??""}`)),f(x,D)};w(S,x=>{L()!=="general"&&x(h)})}f(I,P)}),r(m),r(o),f(l,o)};w(ee,l=>{e(d),v(()=>Object.keys(e(d)).length>1||Object.keys(e(d)).length===1&&!e(d).general)&&l(ve)})}var oe=i(ee,2),ye=a(oe),he=i(a(ye),2),vt=a(he,!0);r(he),r(ye);var Ae=i(ye,2);{var ct=l=>{var o=Qt(),m=a(o),I=a(m,!0);r(m);var M=i(m,2);{var O=P=>{var S=Gt(),h=a(S,!0);r(S),k(()=>_(h,(e(t),v(()=>e(t).customerInfo.phone)))),f(P,S)};w(M,P=>{e(t),v(()=>e(t).customerInfo.phone)&&P(O)})}var L=i(M,2);{var z=P=>{var S=Kt(),h=a(S,!0);r(S),k(()=>_(h,(e(t),v(()=>e(t).customerInfo.address)))),f(P,S)};w(L,P=>{e(t),v(()=>e(t).customerInfo.address)&&P(z)})}r(o),k(()=>_(I,(e(t),v(()=>e(t).customerInfo.name)))),f(l,o)},ut=l=>{var o=Wt();$("click",o,()=>j(se,!0)),f(l,o)};w(Ae,l=>{e(t),v(()=>{var o,m;return(m=(o=e(t))==null?void 0:o.customerInfo)==null?void 0:m.name})?l(ct):l(ut,!1)})}var mt=i(Ae,2);{var ft=l=>{var o=Xt(),m=a(o,!0);r(o),k(()=>_(m,(e(d),v(()=>e(d).customer)))),f(l,o)};w(mt,l=>{e(d),v(()=>e(d).customer)&&l(ft)})}r(oe);var we=i(oe,2),ke=i(a(we),2),Oe=i(a(ke),2);de(Oe),r(ke);var Ie=i(ke,2),ce=i(a(Ie),2);de(ce);var pt=i(ce,2);{var bt=l=>{var o=Yt(),m=a(o,!0);r(o),k(()=>_(m,(e(d),v(()=>e(d).createdBy)))),f(l,o)};w(pt,l=>{e(d),v(()=>e(d).createdBy)&&l(bt)})}r(Ie);var Le=i(Ie,2),Ue=i(a(Le),2);de(Ue),r(Le),r(we);var $e=i(we,2),Pe=a($e),gt=i(a(Pe),2);r(Pe);var ze=i(Pe,2);{var _t=l=>{var o=Zt(),m=a(o,!0);r(o),k(()=>_(m,(e(d),v(()=>e(d).items)))),f(l,o)};w(ze,l=>{e(d),v(()=>e(d).items)&&l(_t)})}var Se=i(ze,2);pe(Se,5,()=>(e(t),v(()=>e(t).items)),be,(l,o,m)=>{var I=rr(),M=a(I),O=a(M),L=a(O),z=a(L),P=a(z,!0);r(z);var S=i(z,2);{var h=C=>{var K=er(),q=a(K);r(K),k(()=>_(q,`规格: ${e(o),v(()=>e(o).specification)??""}`)),f(C,K)};w(S,C=>{e(o),v(()=>e(o).specification)&&C(h)})}var x=i(S,2),D=a(x);r(x),r(L),r(O);var c=i(O,2),U=a(c),E=i(U,2),Y=i(E,2);{var V=C=>{var K=tr();$("click",K,()=>ot(m)),f(C,K)};w(Y,C=>{e(t),v(()=>e(t).items.length>1)&&C(V)})}r(c),r(M);var te=i(M,2),T=a(te),Z=i(a(T),2);de(Z),r(T);var B=i(T,2),N=i(a(B),2);de(N),r(B);var G=i(B,2),me=i(a(G),2),fe=a(me,!0);r(me),r(G),r(te),r(I),k(C=>{_(P,(e(o),v(()=>e(o).productName||"未选择商品"))),_(D,`单位: ${e(o),v(()=>e(o).unit)??""}`),_(fe,C)},[()=>(e(o),v(()=>De(e(o).amount)))]),$("click",U,()=>st(m)),$("click",E,()=>it(m)),re(Z,()=>e(o).quantity,C=>(e(o).quantity=C,Ke(()=>e(t)))),$("input",Z,()=>xe(m)),re(N,()=>e(o).unitPrice,C=>(e(o).unitPrice=C,Ke(()=>e(t)))),$("input",N,()=>xe(m)),f(l,I)}),r(Se);var Fe=i(Se,2),He=a(Fe),Ee=i(a(He),2),xt=a(Ee,!0);r(Ee),r(He),r(Fe),r($e);var je=i($e,2),Je=i(a(je),2);Ct(Je),r(je);var Re=i(je,2),Ve=a(Re),ue=i(Ve,2),yt=a(ue,!0);r(ue),r(Re),r(u);var Te=i(u,2);{var ht=l=>{var o=dr(),m=a(o),I=a(m),M=a(I),O=i(a(M),2);r(M),r(I);var L=i(I,2),z=a(L);{var P=h=>{var x=ar(),D=i(a(x),2);r(x),$("click",D,()=>H("/mobile/customers/new")),f(h,x)},S=h=>{var x=nr();pe(x,5,()=>e(R),be,(D,c)=>{var U=ir(),E=a(U),Y=a(E,!0);r(E);var V=i(E,2);{var te=B=>{var N=sr(),G=a(N,!0);r(N),k(()=>_(G,(e(c),v(()=>e(c).phone)))),f(B,N)};w(V,B=>{e(c),v(()=>e(c).phone)&&B(te)})}var T=i(V,2);{var Z=B=>{var N=or(),G=a(N,!0);r(N),k(()=>_(G,(e(c),v(()=>e(c).category)))),f(B,N)};w(T,B=>{e(c),v(()=>e(c).category)&&B(Z)})}r(U),k(()=>_(Y,(e(c),v(()=>e(c).name)))),$("click",U,()=>_e(e(c))),f(D,U)}),r(x),f(h,x)};w(z,h=>{e(R),v(()=>e(R).length===0)?h(P):h(S,!1)})}r(L),r(m),r(o),$("click",O,()=>j(se,!1)),f(l,o)};w(Te,l=>{e(se)&&l(ht)})}var wt=i(Te,2);{var kt=l=>{var o=pr(),m=a(o),I=a(m),M=a(I),O=i(a(M),2);r(M),r(I);var L=i(I,2),z=a(L);{var P=h=>{var x=lr(),D=i(a(x),2);r(x),$("click",D,()=>H("/mobile/products/new")),f(h,x)},S=h=>{var x=fr();pe(x,5,()=>e(W),be,(D,c)=>{var U=mr(),E=a(U),Y=a(E),V=a(Y),te=a(V,!0);r(V);var T=i(V,2);{var Z=q=>{var F=vr(),ie=a(F,!0);r(F),k(()=>_(ie,(e(c),v(()=>e(c).category)))),f(q,F)};w(T,q=>{e(c),v(()=>e(c).category)&&q(Z)})}var B=i(T,2),N=a(B);r(B);var G=i(B,2);{var me=q=>{var F=cr(),ie=a(F);r(F),k(J=>_(ie,`规格: ${J??""}`),[()=>(e(c),v(()=>{var J,ne;return((J=e(c).specifications.find(It=>It.isDefault))==null?void 0:J.name)||((ne=e(c).specifications[0])==null?void 0:ne.name)||"无"}))]),f(q,F)};w(G,q=>{e(c),v(()=>e(c).specifications.length>0)&&q(me)})}r(Y);var fe=i(Y,2),C=a(fe);{var K=q=>{var F=ur(),ie=a(F);r(F),k(J=>_(ie,`¥${J??""}`),[()=>(e(c),v(()=>{var J;return((J=e(c).prices.find(ne=>ne.type==="sale"&&ne.isDefault)||e(c).prices[0])==null?void 0:J.price.toFixed(2))||"0.00"}))]),f(q,F)};w(C,q=>{e(c),v(()=>e(c).prices.length>0)&&q(K)})}r(fe),r(E),r(U),k(()=>{_(te,(e(c),v(()=>e(c).name))),_(N,`单位: ${e(c),v(()=>e(c).unit)??""}`)}),$("click",U,()=>Ce(e(c))),f(D,U)}),r(x),f(h,x)};w(z,h=>{e(W),v(()=>e(W).length===0)?h(P):h(S,!1)})}r(L),r(m),r(o),$("click",O,()=>j(ge,!1)),f(l,o)};w(wt,l=>{e(ge)&&l(kt)})}k(l=>{_(vt,(e(t),v(()=>{var o,m;return(m=(o=e(t))==null?void 0:o.customerInfo)!=null&&m.name?"更换客户":"选择客户"}))),qt(ce,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent
               ${e(d),v(()=>e(d).createdBy?"border-red-500":"")??""}`),_(xt,l),ue.disabled=e(ae),_(yt,e(ae)?"保存中...":"保存")},[()=>(e(t),v(()=>De(e(t).totalAmount)))]),$("click",he,()=>j(se,!0)),re(Oe,()=>e(t).date,l=>g(t,e(t).date=l)),re(ce,()=>e(t).createdBy,l=>g(t,e(t).createdBy=l)),re(Ue,()=>e(t).deliveryDate,l=>g(t,e(t).deliveryDate=l)),$("click",gt,at),re(Je,()=>e(t).notes,l=>g(t,e(t).notes=l)),$("click",Ve,()=>H("/mobile/sales")),$("click",ue,()=>Me("draft")),f(s,n)};w(dt,s=>{e(t)&&s(lt)})}f(We,Ne),Bt(),Ze()}export{Dr as component};
