import"../chunks/Bzak7iHL.js";import{i as Ne}from"../chunks/BvNKmLqF.js";import{p as Pe,m as w,o as ze,f as b,a as Be,t as m,g as e,e as g,b as c,c as Je,i as l,s,d,k as u,r as i,n as Le,z as le,j as f}from"../chunks/D2QV5ZPr.js";import{i as _}from"../chunks/BvOdW7jM.js";import{e as Ae,i as Ee}from"../chunks/IKNvqO1Y.js";import{r as k}from"../chunks/CdHOzu_t.js";import{s as $}from"../chunks/Baws9BAC.js";import{b as x}from"../chunks/fy4Fdf6-.js";import{M as Fe}from"../chunks/DO-NYQEs.js";import{e as He}from"../chunks/BFtLDb_d.js";import{g as ie}from"../chunks/BqcfPq16.js";var qe=b('<div slot="actions"><button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors disabled:opacity-50" aria-label="保存"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button></div>'),Ge=b('<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-600 text-sm"> </p></div>'),Ke=b('<p class="text-red-500 text-sm mt-1"> </p>'),Qe=b('<p class="text-red-500 text-sm mt-1"> </p>'),Re=b('<p class="text-red-500 text-sm mt-1"> </p>'),Te=b('<p class="text-red-500 text-sm mt-1"> </p>'),Ue=b('<button class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors"> </button>'),Ve=b('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择客户分类</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4 space-y-2"><!> <button class="w-full text-left p-3 rounded-lg text-blue-500 hover:bg-blue-50 transition-colors">+ 添加新分类</button></div></div></div>'),We=b('<!> <div class="p-4 space-y-6"><!> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">基本信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">客户名称 <span class="text-red-500">*</span></label> <input type="text" placeholder="请输入客户名称"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">客户分类</label> <button type="button" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-left focus:ring-2 focus:ring-blue-500 focus:border-transparent flex items-center justify-between"><span> </span> <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">期初欠款</label> <input type="number" placeholder="请输入期初欠款" step="0.01" min="0"/> <!></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">联系信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">电话</label> <input type="tel" placeholder="请输入电话"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">备用电话</label> <input type="tel" placeholder="请输入备用电话" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">地址</label> <textarea placeholder="请输入地址" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">传真</label> <input type="text" placeholder="请输入传真" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">邮箱</label> <input type="email" placeholder="请输入邮箱"/> <!></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><label class="block text-sm font-medium text-gray-700 mb-1">备注</label> <textarea placeholder="请输入备注信息" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea></div> <div class="flex space-x-3 pb-6"><button type="button" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">取消</button> <button type="button" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50"> </button></div></div> <!>',1);function nt(ne,de){Pe(de,!1);let r=w(He()),n=w({}),y=w(!1),v=w(["未分类","重要客户","普通客户","潜在客户"]),h=w(!1);ze(()=>{ce()});const ce=()=>{try{const t=localStorage.getItem("customer_categories");if(t){const a=JSON.parse(t);u(v,[...new Set([...e(v),...a])])}}catch(t){console.error("加载客户分类失败:",t)}},G=()=>{try{localStorage.setItem("customer_categories",JSON.stringify(e(v)))}catch(t){console.error("保存客户分类失败:",t)}},ue=()=>(u(n,{}),e(r).name.trim()||d(n,e(n).name="客户名称不能为空"),e(r).phone.trim()&&!/^1[3-9]\d{9}$/.test(e(r).phone.replace(/[-\s]/g,""))&&d(n,e(n).phone="请输入有效的手机号码"),e(r).email&&e(r).email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e(r).email.trim())&&d(n,e(n).email="请输入有效的邮箱地址"),e(r).initialDebt<0&&d(n,e(n).initialDebt="期初欠款不能为负数"),Object.keys(e(n)).length===0),K=async()=>{if(ue()){u(y,!0);try{const t=localStorage.getItem("customers"),a=t?JSON.parse(t):[];if(a.some(o=>o.name===e(r).name.trim())){d(n,e(n).name="客户名称已存在"),u(y,!1);return}d(r,e(r).name=e(r).name.trim()),d(r,e(r).updatedAt=new Date().toISOString()),a.push(e(r)),localStorage.setItem("customers",JSON.stringify(a)),e(r).category&&!e(v).includes(e(r).category)&&(e(v).push(e(r).category),G()),ie("/mobile/customers")}catch(t){console.error("保存客户失败:",t),d(n,e(n).general="保存失败，请重试")}finally{u(y,!1)}}},be=t=>{d(r,e(r).category=t),u(h,!1)},ve=()=>{const t=prompt("请输入新的客户分类:");if(t&&t.trim()){const a=t.trim();e(v).includes(a)||(e(v).push(a),G()),d(r,e(r).category=a)}u(h,!1)},pe=t=>{const a=t.target;let o=a.value.replace(/\D/g,"");o.length>11&&(o=o.slice(0,11)),o.length>7?o=o.replace(/(\d{3})(\d{4})(\d{4})/,"$1-$2-$3"):o.length>3&&(o=o.replace(/(\d{3})(\d{4})/,"$1-$2")),a.value=o,d(r,e(r).phone=o)};Ne();var Q=We(),R=Be(Q);Fe(R,{title:"新建客户",showBack:!0,backgroundColor:"bg-blue-500",$$slots:{actions:(t,a)=>{var o=qe(),p=l(o);i(o),m(()=>p.disabled=e(y)),g("click",p,K),c(t,o)}}});var I=s(R,2),T=l(I);{var me=t=>{var a=Ge(),o=l(a),p=l(o,!0);i(o),i(a),m(()=>f(p,e(n).general)),c(t,a)};_(T,t=>{e(n).general&&t(me)})}var O=s(T,2),N=s(l(O),2),C=s(l(N),2);k(C);var ge=s(C,2);{var fe=t=>{var a=Ke(),o=l(a,!0);i(a),m(()=>f(o,e(n).name)),c(t,a)};_(ge,t=>{e(n).name&&t(fe)})}i(N);var P=s(N,2),z=s(l(P),2),B=l(z),xe=l(B,!0);i(B),Le(2),i(z),i(P);var U=s(P,2),S=s(l(U),2);k(S);var ye=s(S,2);{var _e=t=>{var a=Qe(),o=l(a,!0);i(a),m(()=>f(o,e(n).initialDebt)),c(t,a)};_(ye,t=>{e(n).initialDebt&&t(_e)})}i(U),i(O);var J=s(O,2),L=s(l(J),2),A=s(l(L),2),he=s(A,2);{var we=t=>{var a=Re(),o=l(a,!0);i(a),m(()=>f(o,e(n).phone)),c(t,a)};_(he,t=>{e(n).phone&&t(we)})}i(L);var E=s(L,2),V=s(l(E),2);k(V),i(E);var F=s(E,2),W=s(l(F),2);le(W),i(F);var H=s(F,2),X=s(l(H),2);k(X),i(H);var Y=s(H,2),D=s(l(Y),2);k(D);var ke=s(D,2);{var $e=t=>{var a=Te(),o=l(a,!0);i(a),m(()=>f(o,e(n).email)),c(t,a)};_(ke,t=>{e(n).email&&t($e)})}i(Y),i(J);var q=s(J,2),Z=s(l(q),2);le(Z),i(q);var ee=s(q,2),te=l(ee),j=s(te,2),Ce=l(j,!0);i(j),i(ee),i(I);var Se=s(I,2);{var De=t=>{var a=Ve(),o=l(a),p=l(o),re=l(p),je=s(l(re),2);i(re),i(p);var ae=s(p,2),oe=l(ae);Ae(oe,1,()=>e(v),Ee,(Ie,se)=>{var M=Ue(),Oe=l(M,!0);i(M),m(()=>f(Oe,e(se))),g("click",M,()=>be(e(se))),c(Ie,M)});var Me=s(oe,2);i(ae),i(o),i(a),g("click",je,()=>u(h,!1)),g("click",Me,ve),c(t,a)};_(Se,t=>{e(h)&&t(De)})}m(()=>{$(C,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(n).name?"border-red-500":""}`),$(B,1,e(r).category?"text-gray-900":"text-gray-500"),f(xe,e(r).category||"请选择客户分类"),$(S,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(n).initialDebt?"border-red-500":""}`),$(A,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(n).phone?"border-red-500":""}`),$(D,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent
               ${e(n).email?"border-red-500":""}`),j.disabled=e(y),f(Ce,e(y)?"保存中...":"保存")}),x(C,()=>e(r).name,t=>d(r,e(r).name=t)),g("click",z,()=>u(h,!0)),x(S,()=>e(r).initialDebt,t=>d(r,e(r).initialDebt=t)),g("input",A,pe),x(V,()=>e(r).backupPhone,t=>d(r,e(r).backupPhone=t)),x(W,()=>e(r).address,t=>d(r,e(r).address=t)),x(X,()=>e(r).fax,t=>d(r,e(r).fax=t)),x(D,()=>e(r).email,t=>d(r,e(r).email=t)),x(Z,()=>e(r).notes,t=>d(r,e(r).notes=t)),g("click",te,()=>ie("/mobile/customers")),g("click",j,K),c(ne,Q),Je()}export{nt as component};
