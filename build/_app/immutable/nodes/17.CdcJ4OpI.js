import"../chunks/Bzak7iHL.js";import{i as Jt}from"../chunks/BvNKmLqF.js";import{p as Ot,f as g,a as it,s as r,i as t,r as e,n as Nt,t as P,w as v,g as a,j as l,b as u,q as b,m as R,k,e as j,c as qt,o as Wt,y as Et,_ as Xt}from"../chunks/D2QV5ZPr.js";import{i as $}from"../chunks/BvOdW7jM.js";import{s as Ht}from"../chunks/Baws9BAC.js";import{b as Rt}from"../chunks/CMTa04h2.js";import{s as Zt,a as te}from"../chunks/GeVYpaAz.js";import{M as ee}from"../chunks/DO-NYQEs.js";import{e as Bt,i as Pt}from"../chunks/IKNvqO1Y.js";import{p as zt}from"../chunks/BR_REAzN.js";import{f as re,n as Ft,e as ae,M as Lt}from"../chunks/DDWXNEKt.js";import{p as se}from"../chunks/D2SIzPNB.js";import{g as Ct}from"../chunks/BqcfPq16.js";var oe=g('<div class="mb-4 print:hidden"><div class="block md:hidden mb-4"><!></div> <div class="hidden md:flex space-x-3 action-buttons justify-center"><button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:opacity-50"> </button> <button class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">æ‰“å°/ä¿å­˜PDF</button></div></div>'),ne=g('<tr class="hover:bg-gray-50"><td class="border border-gray-800 px-2 py-1 text-center svelte-4ukwj1"></td><td class="border border-gray-800 px-2 py-1 text-center svelte-4ukwj1"> </td><td class="border border-gray-800 px-2 py-1 text-center svelte-4ukwj1"> </td><td class="border border-gray-800 px-2 py-1 text-center svelte-4ukwj1"> </td><td class="border border-gray-800 px-2 py-1 text-center svelte-4ukwj1"> </td><td class="border border-gray-800 px-2 py-1 text-center svelte-4ukwj1"> </td><td class="border border-gray-800 px-2 py-1 text-center font-semibold svelte-4ukwj1"> </td></tr>'),de=g('<tr><td class="border border-gray-800 px-2 py-1 text-center svelte-4ukwj1" style="height: 20px;"></td><td class="border border-gray-800 px-2 py-1 svelte-4ukwj1"></td><td class="border border-gray-800 px-2 py-1 svelte-4ukwj1"></td><td class="border border-gray-800 px-2 py-1 svelte-4ukwj1"></td><td class="border border-gray-800 px-2 py-1 svelte-4ukwj1"></td><td class="border border-gray-800 px-2 py-1 svelte-4ukwj1"></td><td class="border border-gray-800 px-2 py-1 svelte-4ukwj1"></td></tr>'),ie=g('<p class="mb-1"><span class="font-medium">å¤‡æ³¨ï¼š</span> </p>'),le=g(`<!> <div class="sales-invoice bg-white shadow-lg print:shadow-none svelte-4ukwj1" style="max-width: 1280px; margin: 0 auto; padding: 20px; box-sizing: border-box; font-family: 'Microsoft YaHei', 'SimSun', serif; font-size: 13px; line-height: 1.2;"><div class="text-center mb-3 border-b-2 border-blue-500 pb-2"><h1 class="text-xl font-bold text-blue-800 mb-1"> </h1> <div class="text-sm text-gray-600 flex justify-center space-x-8 mb-1"><span> </span> <span> </span></div> <h2 class="text-xl font-bold text-gray-800">é”€ å”® å•</h2></div> <div class="grid grid-cols-3 gap-4 mb-2 text-sm" style="align-items: center;"><div style="display: flex; align-items: center;"><strong>å®¢æˆ·åç§°ï¼š</strong><span> </span></div> <div style="display: flex; align-items: center;"><strong>å®¢æˆ·ç”µè¯ï¼š</strong><span> </span></div> <div style="display: flex; align-items: center;"><strong>åˆ¶å•äººï¼š</strong><span> </span></div></div> <div class="grid grid-cols-3 gap-4 mb-3 text-sm" style="align-items: center;"><div style="display: flex; align-items: center;"><strong>å®¢æˆ·åœ°å€ï¼š</strong><span> </span></div> <div style="display: flex; align-items: center;"><strong>ç‰©æµåç§°ï¼š</strong><span></span></div> <div style="display: flex; align-items: center;"><strong>å¼€å•æ—¥æœŸï¼š</strong><span> </span></div></div> <div class="mb-2"><table class="w-full border-collapse border-2 border-gray-800 text-xs svelte-4ukwj1"><thead><tr class="bg-blue-100"><th class="border border-gray-800 px-2 py-1 text-center font-bold svelte-4ukwj1" style="width: 8%">åºå·</th><th class="border border-gray-800 px-2 py-1 text-center font-bold svelte-4ukwj1" style="width: 30%">äº§å“åç§°</th><th class="border border-gray-800 px-2 py-1 text-center font-bold svelte-4ukwj1" style="width: 20%">è§„æ ¼å‹å·</th><th class="border border-gray-800 px-2 py-1 text-center font-bold svelte-4ukwj1" style="width: 10%">å•ä½</th><th class="border border-gray-800 px-2 py-1 text-center font-bold svelte-4ukwj1" style="width: 10%">æ•°é‡</th><th class="border border-gray-800 px-2 py-1 text-center font-bold svelte-4ukwj1" style="width: 12%">å•ä»·</th><th class="border border-gray-800 px-2 py-1 text-center font-bold svelte-4ukwj1" style="width: 10%">é‡‘é¢</th></tr></thead><tbody><!><!></tbody></table></div> <div class="flex justify-between items-center mb-2 text-sm"><div><span class="font-medium text-gray-700">åˆè®¡ï¼ˆå¤§å†™ï¼‰ï¼š</span> <span class="font-bold text-red-600"> </span></div> <div><span class="font-medium text-gray-700">åˆè®¡ï¼š</span> <span class="text-lg font-bold text-red-600"> </span></div></div> <div class="mb-2 text-sm"><!> <div class="flex justify-between items-center"><p class="text-gray-600 text-xs">ä»¥ä¸Šè´§å“è¯·æ ¸å¯¹æ¸…æ¥šï¼Œå¦‚æœ‰è´¨é‡é—®é¢˜è¯·åœ¨3æ—¥å†…è‡´ç”µå‘ŠçŸ¥æœ¬å…¬å¸ï¼Œè°¢è°¢ï¼</p> <span class="text-xs text-gray-600">ç¬¬1é¡µ/å…±1é¡µ</span></div></div> <div class="grid grid-cols-2 gap-8 text-sm mt-2"><div><span class="font-medium text-gray-700">é”€å”®å•ä½åŠç»æ‰‹äººï¼ˆç­¾ç« ï¼‰ï¼š</span></div> <div><span class="font-medium text-gray-700">å®¢æˆ·å•ä½åŠç»æ‰‹äººï¼ˆç­¾ç« ï¼‰ï¼š</span></div></div></div> <div class="no-print flex justify-center space-x-4 mt-6 mb-8 svelte-4ukwj1"><button class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-colors font-medium">ğŸ–¨ï¸ æ‰“å°/ä¿å­˜PDF</button> <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">ğŸ“¸ ä¿å­˜ä¸ºå›¾ç‰‡</button></div>`,1);function ve(ht,L){Ot(L,!1);let s=zt(L,"invoice",8),wt=zt(L,"showActions",8,!0),N=R(),d=R(!1);const T=n=>n.toFixed(2),C=re,V=n=>Array(n).fill(null),A=async()=>{if(a(N)){k(d,!0);try{const n=`é”€å”®å•-${s().invoiceNumber}-${C(s().date)}`;await ae(a(N),n)}catch(n){console.error("å¯¼å‡ºå¤±è´¥:",n),alert("å¯¼å‡ºå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{k(d,!1)}}},Y=()=>{window.print()};Jt();var lt=le(),G=it(lt);{var vt=n=>{var i=oe(),h=t(i),ot=t(h);Lt(ot,{get targetElement(){return a(N)},fileName:"é”€å”®å•",showButton:!0}),e(h);var nt=r(h,2),S=t(nt),St=t(S,!0);e(S);var dt=r(S,2);e(nt),e(i),P(()=>{S.disabled=a(d),l(St,a(d)?"å¯¼å‡ºä¸­...":"ä¿å­˜ä¸ºå›¾ç‰‡")}),j("click",S,A),j("click",dt,Y),u(n,i)};$(G,n=>{wt()&&n(vt)})}var z=r(G,2),K=t(z),F=t(K),ct=t(F,!0);e(F);var Q=r(F,2),J=t(Q),pt=t(J);e(J);var ut=r(J,2),kt=t(ut);e(ut),e(Q),Nt(2),e(K);var U=r(K,2),o=t(U),p=r(t(o)),m=t(p,!0);e(p),e(o);var y=r(o,2),M=r(t(y)),w=t(M,!0);e(M),e(y);var f=r(y,2),_=r(t(f)),W=t(_,!0);e(_),e(f),e(U);var I=r(U,2),O=t(I),D=r(t(O)),jt=t(D,!0);e(D),e(O);var q=r(O,4),bt=r(t(q)),X=t(bt,!0);e(bt),e(q),e(I);var E=r(I,2),Z=t(E),H=r(t(Z)),mt=t(H);Bt(mt,1,()=>(b(s()),v(()=>s().items)),Pt,(n,i,h)=>{var ot=ne(),nt=t(ot);nt.textContent=h+1;var S=r(nt),St=t(S,!0);e(S);var dt=r(S),Tt=t(dt,!0);e(dt);var $t=r(dt),Vt=t($t,!0);e($t);var At=r($t),Yt=t(At,!0);e(At);var Mt=r(At),Gt=t(Mt,!0);e(Mt);var Dt=r(Mt),Kt=t(Dt,!0);e(Dt),e(ot),P((Qt,Ut)=>{l(St,(a(i),v(()=>a(i).productName))),l(Tt,(a(i),v(()=>a(i).specification))),l(Vt,(a(i),v(()=>a(i).unit))),l(Yt,(a(i),v(()=>a(i).quantity))),l(Gt,Qt),l(Kt,Ut)},[()=>(a(i),v(()=>T(a(i).unitPrice))),()=>(a(i),v(()=>T(a(i).amount)))]),u(n,ot)});var tt=r(mt);Bt(tt,1,()=>(b(s()),v(()=>V(Math.max(0,8-s().items.length)))),Pt,(n,i)=>{var h=de();u(n,h)}),e(H),e(Z),e(E);var et=r(E,2),rt=t(et),xt=r(t(rt),2),gt=t(xt,!0);e(xt),e(rt);var at=r(rt,2),ft=r(t(at),2),yt=t(ft,!0);e(ft),e(at),e(et);var _t=r(et,2),It=t(_t);{var c=n=>{var i=ie(),h=r(t(i),1,!0);e(i),P(()=>l(h,(b(s()),v(()=>s().notes)))),u(n,i)};$(It,n=>{b(s()),v(()=>s().notes)&&n(c)})}Nt(2),e(_t),Nt(2),e(z),Rt(z,n=>k(N,n),()=>a(N));var x=r(z,2),B=t(x),st=r(B,2);e(x),P((n,i,h)=>{l(ct,(b(s()),v(()=>s().companyInfo.name))),l(pt,`åœ°å€ï¼š${b(s()),v(()=>s().companyInfo.address)??""}`),l(kt,`ç”µè¯ï¼š${b(s()),v(()=>s().companyInfo.phone)??""}`),l(m,(b(s()),v(()=>s().customerInfo.name))),l(w,(b(s()),v(()=>s().customerInfo.phone||""))),l(W,(b(s()),v(()=>s().createdBy))),l(jt,(b(s()),v(()=>s().customerInfo.address||""))),l(X,n),l(gt,i),l(yt,h)},[()=>(b(s()),v(()=>C(s().date))),()=>(b(Ft),b(s()),v(()=>Ft(s().totalAmount))),()=>(b(s()),v(()=>T(s().totalAmount)))]),j("click",B,()=>window.print()),j("click",st,A),u(ht,lt),qt()}var ce=g('<button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="ç¼–è¾‘"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button>'),pe=g('<div slot="actions"><!> <button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="æ‰“å°"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg></button></div>'),ue=g('<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-red-500 mx-auto"></div> <p class="text-gray-500 mt-2">åŠ è½½ä¸­...</p></div>'),be=g('<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center"><p class="text-red-600"> </p> <button class="mt-2 bg-red-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors">è¿”å›é”€å”®å•åˆ—è¡¨</button></div>'),me=g('<div class="text-sm text-gray-600"><span>æœªä»˜é‡‘é¢:</span> <span class="ml-2 text-red-600 font-medium"> </span></div>'),xe=g('<button class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors">ç¼–è¾‘</button>'),ge=g('<button class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors">åˆ é™¤</button>'),fe=g('<div class="bg-white rounded-lg shadow-sm border overflow-hidden"><!></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><h3 class="font-medium text-gray-900 mb-3">ä¿å­˜é€‰é¡¹</h3> <!></div> <div class="bg-white rounded-lg p-4 shadow-sm border mt-6"><div class="flex items-center justify-between mb-4"><h3 class="font-medium text-gray-900">å•æ®çŠ¶æ€</h3> <div class="flex space-x-2"><div> </div> <div> </div></div></div> <!></div> <div class="flex space-x-3 pb-6 mt-6"><!> <button class="flex-1 bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors">æ‰“å°</button> <!></div>',1),ye=g('<!> <div class="p-4 space-y-6"><!></div>',1);function Ee(ht,L){Ot(L,!1);const s=()=>te(se,"$page",wt),[wt,N]=Zt();let d=R(null),T=null,C,V=R(!0),A=R(""),Y=R(null);Wt(()=>{C=s().params.id,lt()});const lt=()=>{try{const o=localStorage.getItem("invoice_history");if(o){const p=JSON.parse(o);if(k(d,p.find(m=>m.id===C)||null),!a(d)){k(A,"é”€å”®å•ä¸å­˜åœ¨"),k(V,!1);return}if(a(d).customerId){const m=localStorage.getItem("customers");m&&(T=JSON.parse(m).find(M=>M.id===a(d).customerId)||null)}}else k(A,"æ²¡æœ‰æ‰¾åˆ°é”€å”®å•æ•°æ®")}catch(o){console.error("åŠ è½½é”€å”®å•å¤±è´¥:",o),k(A,"åŠ è½½é”€å”®å•å¤±è´¥")}finally{k(V,!1)}},G=()=>{Ct(`/mobile/sales/${C}/edit`)},vt=()=>{window.print()},z=()=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé”€å”®å•å—ï¼Ÿ"))try{const o=localStorage.getItem("invoice_history");if(o){const m=JSON.parse(o).filter(y=>y.id!==C);localStorage.setItem("invoice_history",JSON.stringify(m)),Ct("/mobile/sales")}}catch(o){console.error("åˆ é™¤é”€å”®å•å¤±è´¥:",o),alert("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}},K=o=>`Â¥${o.toFixed(2)}`,F=o=>{const p={draft:{name:"è‰ç¨¿",color:"text-yellow-600 bg-yellow-100"},sent:{name:"å·²å‘é€",color:"text-blue-600 bg-blue-100"},paid:{name:"å·²ä»˜æ¬¾",color:"text-green-600 bg-green-100"},cancelled:{name:"å·²å–æ¶ˆ",color:"text-red-600 bg-red-100"}};return p[o]||p.draft},ct=o=>{const p={unpaid:{name:"æœªä»˜æ¬¾",color:"text-red-600"},partial:{name:"éƒ¨åˆ†ä»˜æ¬¾",color:"text-yellow-600"},paid:{name:"å·²ä»˜æ¬¾",color:"text-green-600"}};return p[o]||p.unpaid};Jt();var Q=ye(),J=it(Q);ee(J,{title:"é”€å”®å•è¯¦æƒ…",showBack:!0,showActions:!0,backgroundColor:"bg-red-500",$$slots:{actions:(o,p)=>{var m=pe(),y=t(m);{var M=f=>{var _=ce();j("click",_,G),u(f,_)};$(y,f=>{a(d)&&a(d).status==="draft"&&f(M)})}var w=r(y,2);e(m),j("click",w,vt),u(o,m)}}});var pt=r(J,2),ut=t(pt);{var kt=o=>{var p=ue();u(o,p)},U=o=>{var p=Et(),m=it(p);{var y=w=>{var f=be(),_=t(f),W=t(_,!0);e(_);var I=r(_,2);e(f),P(()=>l(W,a(A))),j("click",I,()=>Ct("/mobile/sales")),u(w,f)},M=w=>{var f=Et(),_=it(f);{var W=I=>{var O=fe(),D=it(O),jt=t(D);ve(jt,{get invoice(){return a(d)},showActions:!1}),e(D),Rt(D,c=>k(Y,c),()=>a(Y));var q=r(D,2),bt=r(t(q),2);{let c=Xt(()=>`é”€å”®å•-${a(d).invoiceNumber}`);Lt(bt,{get targetElement(){return a(Y)},get fileName(){return a(c)},showButton:!0})}e(q);var X=r(q,2),E=t(X),Z=r(t(E),2),H=t(Z),mt=t(H,!0);e(H);var tt=r(H,2),et=t(tt,!0);e(tt),e(Z),e(E);var rt=r(E,2);{var xt=c=>{var x=me(),B=r(t(x),2),st=t(B,!0);e(B),e(x),P(n=>l(st,n),[()=>K(a(d).totalAmount-a(d).paidAmount)]),u(c,x)};$(rt,c=>{a(d).paymentStatus!=="paid"&&c(xt)})}e(X);var gt=r(X,2),at=t(gt);{var ft=c=>{var x=xe();j("click",x,G),u(c,x)};$(at,c=>{a(d).status==="draft"&&c(ft)})}var yt=r(at,2),_t=r(yt,2);{var It=c=>{var x=ge();j("click",x,z),u(c,x)};$(_t,c=>{a(d).status==="draft"&&c(It)})}e(gt),P((c,x,B,st)=>{Ht(H,1,`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${c??""}`),l(mt,x),Ht(tt,1,`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${B??""}`),l(et,st)},[()=>F(a(d).status).color,()=>F(a(d).status).name,()=>ct(a(d).paymentStatus).color,()=>ct(a(d).paymentStatus).name]),j("click",yt,vt),u(I,O)};$(_,I=>{a(d)&&I(W)},!0)}u(w,f)};$(m,w=>{a(A)?w(y):w(M,!1)},!0)}u(o,p)};$(ut,o=>{a(V)?o(kt):o(U,!1)})}e(pt),u(ht,Q),qt(),N()}export{Ee as component};
