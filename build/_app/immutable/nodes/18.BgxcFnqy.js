import"../chunks/Bzak7iHL.js";import{i as St}from"../chunks/XlqFUZ3x.js";import{p as Bt,o as jt,l as Ge,i as Ct,f as p,a as Ne,b as f,c as Nt,g as e,e as Q,t as k,j as $,h as a,k as B,m as b,r,s as n,u as v,d as _,C as Qe,v as Mt,q as At,D as Dt,E as Ot}from"../chunks/nbkepknC.js";import{i as w}from"../chunks/BcVSc5tD.js";import{e as be,i as _e}from"../chunks/DVrF0WE5.js";import{r as le}from"../chunks/2WVzPzKa.js";import{s as qt}from"../chunks/BYJuMw6P.js";import{b as ae}from"../chunks/fLdq3W06.js";import{s as Lt,a as Ft}from"../chunks/D_8yISCJ.js";import{M as Ut}from"../chunks/4cH0hlCX.js";import{a as zt,b as Ht,d as We,e as Jt}from"../chunks/D1IVDrhe.js";import{g as Et}from"../chunks/DwQhc35S.js";import{p as Rt}from"../chunks/CNYORac8.js";import{g as H}from"../chunks/D3qAVNxD.js";var Vt=p('<div slot="actions"><button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors disabled:opacity-50" aria-label="保存"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button></div>'),Tt=p('<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-600 text-sm font-medium"> </p></div>'),Kt=p("<li> </li>"),Yt=p('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3"><p class="text-yellow-800 text-sm font-medium mb-2">请检查以下问题：</p> <ul class="text-yellow-700 text-sm space-y-1"></ul></div>'),Gt=p('<div class="text-sm text-gray-600"> </div>'),Qt=p('<div class="text-sm text-gray-600"> </div>'),Wt=p('<div class="bg-gray-50 rounded-lg p-3"><div class="font-medium text-gray-900"> </div> <!> <!></div>'),Xt=p('<button class="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-red-300 hover:text-red-500 transition-colors">点击选择客户</button>'),Zt=p('<p class="text-red-500 text-sm"> </p>'),er=p('<p class="text-red-500 text-sm mt-1"> </p>'),tr=p('<p class="text-red-500 text-sm"> </p>'),rr=p('<span class="text-gray-600 ml-2"> </span>'),ar=p('<button class="p-1 text-red-500 hover:bg-red-50 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>'),sr=p('<div class="border border-gray-200 rounded-lg p-3"><div class="flex items-start justify-between mb-3"><div class="flex-1"><div class="text-sm"><span class="font-medium text-gray-900"> </span> <!> <span class="text-gray-600 ml-2"> </span></div></div> <div class="flex space-x-2"><button class="p-1 text-blue-500 hover:bg-blue-50 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button> <button class="p-1 text-green-500 hover:bg-green-50 rounded"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button> <!></div></div> <div class="grid grid-cols-3 gap-3"><div><label class="block text-xs text-gray-500 mb-1">数量</label> <input type="number" min="0" step="1" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-red-500 focus:border-transparent"/></div> <div><label class="block text-xs text-gray-500 mb-1">单价</label> <input type="number" min="0" step="0.01" class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-red-500 focus:border-transparent"/></div> <div><label class="block text-xs text-gray-500 mb-1">金额</label> <div class="px-2 py-1 text-sm bg-gray-50 rounded font-medium"> </div></div></div></div>'),or=p('<div class="text-center py-8"><p class="text-gray-500 mb-4">还没有客户数据</p> <button class="bg-blue-500 text-white px-4 py-2 rounded-lg font-medium">添加客户</button></div>'),ir=p('<div class="text-sm text-gray-600"> </div>'),nr=p('<div class="text-xs text-blue-600"> </div>'),dr=p('<button class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors border"><div class="font-medium text-gray-900"> </div> <!> <!></button>'),lr=p('<div class="space-y-2"></div>'),vr=p('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择客户</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4"><!></div></div></div>'),cr=p('<div class="text-center py-8"><p class="text-gray-500 mb-4">还没有产品数据</p> <button class="bg-orange-500 text-white px-4 py-2 rounded-lg font-medium">添加产品</button></div>'),ur=p('<div class="text-xs text-orange-600"> </div>'),mr=p('<div class="text-xs text-gray-500"> </div>'),fr=p('<div class="text-sm font-medium text-orange-600"> </div>'),pr=p('<button class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors border"><div class="flex items-start justify-between"><div class="flex-1"><div class="font-medium text-gray-900"> </div> <!> <div class="text-sm text-gray-600"> </div> <!></div> <div class="text-right"><!></div></div></button>'),gr=p('<div class="space-y-2"></div>'),br=p('<div class="mt-4"><div class="bg-white w-full rounded-lg shadow-sm border max-h-[60vh] overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择产品</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4"><!></div></div></div>'),_r=p('<div class="p-4 space-y-6"><!> <!> <div class="hidden bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">客户信息</h3> <button class="text-red-500 text-sm font-medium"> </button></div> <!> <!></div> <div class="hidden bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">基本信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">日期</label> <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">制单人 <span class="text-red-500">*</span></label> <input type="text" placeholder="请输入制单人"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">送货日期</label> <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"/></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">商品明细</h3> <button class="text-red-500 text-sm font-medium">+ 添加商品</button></div> <!> <div class="space-y-3"></div> <div class="border-t border-gray-200 pt-3"><div class="flex justify-between items-center"><span class="font-medium text-gray-900">合计:</span> <span class="text-xl font-bold text-red-600"> </span></div></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><label class="block text-sm font-medium text-gray-700 mb-1">备注</label> <textarea placeholder="请输入备注信息" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none"></textarea></div> <div class="flex space-x-3 pb-6"><button type="button" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">取消</button> <button type="button" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors disabled:opacity-50"> </button></div></div> <!> <!>',1),xr=p("<!> <!>",1);function Dr(Xe,Ze){Bt(Ze,!1);const O=()=>Ft(Rt,"$page",et),[et,tt]=Lt();let t=Q(null),R=Q([]),W=Q([]),d=Q({}),se=Q(!1),oe=Q(!1),xe=Q(!1),X=Q(-1);const V={name:"佛山市仁腾装饰材料有限公司",address:"佛山市南海盐步大转弯夹板装饰第五期C1座12号",phone:"18575852698",email:"",taxId:""};let ve={...V};const rt=()=>{try{const s=localStorage.getItem("user_info");if(s){const i=JSON.parse(s);ve={name:i.company||V.name,address:i.address||V.address,phone:i.phone||V.phone,email:i.email||V.email,taxId:i.taxId||V.taxId}}else ve={...V}}catch(s){console.warn("读取用户资料失败，使用默认公司信息",s),ve={...V}}};jt(()=>{at(),rt(),st()});const at=()=>{try{const s=localStorage.getItem("customers");s&&B(R,JSON.parse(s));const i=localStorage.getItem("products");i&&B(W,JSON.parse(i))}catch(s){console.error("加载数据失败:",s)}},st=()=>{B(t,zt(ve)),b(t,e(t).items=[]);const s=O().url.searchParams.get("customerId"),i=O().url.searchParams.get("createdBy");if(s){const u=e(R).find(g=>g.id===s);u&&ye(u)}i?b(t,e(t).createdBy=decodeURIComponent(i)):b(t,e(t).createdBy=Et())},ye=s=>{e(t)&&(b(t,e(t).customerId=s.id),b(t,e(t).customerInfo={name:s.name,address:s.address||"",phone:s.phone,email:s.email||""}),B(oe,!1))},Me=s=>{if(e(t)){if(e(X)>=0){const i=e(t).items[e(X)];i.productId=s.id,i.productName=s.name;const u=s.specifications.find(y=>y.isDefault);i.specification=u?u.name:"";const g=s.prices.find(y=>y.type==="sale"&&y.isDefault);i.unitPrice=g?g.price:0,i.unit=s.unit,he(e(X))}else{const i=Ht();i.productId=s.id,i.productName=s.name;const u=s.specifications.find(y=>y.isDefault);i.specification=u?u.name:"";const g=s.prices.find(y=>y.type==="sale"&&y.isDefault);i.unitPrice=g?g.price:0,i.unit=s.unit,i.amount=We(i.quantity,i.unitPrice),e(t).items.push(i)}B(xe,!1),B(X,-1),ce()}},he=s=>{if(!e(t))return;const i=e(t).items[s];i.amount=We(i.quantity,i.unitPrice),ce()},ce=()=>{e(t)&&b(t,e(t).totalAmount=Jt(e(t).items))},ot=()=>{var i;B(X,-1);const s=(i=e(t))==null?void 0:i.customerId;H(`/mobile/products/select?index=-1${s?`&customerId=${s}`:""}`)},it=s=>{var u;B(X,s);const i=(u=e(t))==null?void 0:u.customerId;H(`/mobile/products/select?index=${s}${i?`&customerId=${i}`:""}`)},nt=s=>{e(t)&&e(t).items.length>1&&(e(t).items.splice(s,1),ce())},dt=s=>{if(!e(t))return;const u={...e(t).items[s],id:crypto.randomUUID()};e(t).items.splice(s+1,0,u),ce()},lt=()=>{var s,i,u;return e(t)?(B(d,{}),(i=(s=e(t).customerInfo)==null?void 0:s.name)!=null&&i.trim()||b(d,e(d).customer="请选择客户"),(u=e(t).createdBy)!=null&&u.trim()||b(d,e(d).createdBy="制单人不能为空"),e(t).items.length===0&&b(d,e(d).items="至少需要一个商品项目"),e(t).items.forEach((g,y)=>{g.productName.trim()||b(d,e(d)[`item_${y}_name`]="商品名称不能为空"),g.quantity<=0&&b(d,e(d)[`item_${y}_quantity`]="数量必须大于0"),g.unitPrice<0&&b(d,e(d)[`item_${y}_price`]="单价不能为负数")}),Object.keys(e(d)).length===0):!1},Ae=async(s="draft")=>{if(console.log("开始保存销售单...",{invoice:e(t),status:s}),!e(t)){console.error("保存失败：invoice 为空"),b(d,e(d).general="销售单数据未初始化");return}const i=lt();if(console.log("表单验证结果:",{isValid:i,errors:e(d)}),!i){console.error("保存失败：表单验证未通过",e(d)),b(d,e(d).general="请检查并填写所有必填字段");return}B(se,!0);try{b(t,e(t).status=s),b(t,e(t).type="sale"),b(t,e(t).paymentStatus="unpaid"),b(t,e(t).paidAmount=0);const u=localStorage.getItem("invoice_history"),g=u?JSON.parse(u):[];g.push(e(t)),localStorage.setItem("invoice_history",JSON.stringify(g)),H("/mobile/sales")}catch(u){console.error("保存销售单失败:",u),b(d,e(d).general="保存失败，请重试")}finally{B(se,!1)}},De=s=>`¥${s.toFixed(2)}`;Ge(()=>(e(t),e(R),O(),H),()=>{var s;if(e(t)&&e(R).length>0&&((s=O())!=null&&s.url)){const i=O().url.searchParams.get("customerId");if(i&&!e(t).customerId){const u=e(R).find(g=>g.id===i);if(u){ye(u);const g=new URLSearchParams(O().url.search);g.delete("customerId");const y=g.toString();H(`${O().url.pathname}${y?"?"+y:""}`,{replaceState:!0,noScroll:!0,keepFocus:!0})}}}}),Ge(()=>(O(),e(W),e(t),H),()=>{var s;if((s=O())!=null&&s.url&&e(W).length>0&&e(t)){const i=O().url.searchParams,u=i.get("pickProductId");if(u){const g=parseInt(i.get("index")||"-1",10);B(X,isNaN(g)?-1:g);const y=e(W).find(ie=>ie.id===u);y&&Me(y);const te=new URLSearchParams(O().url.search);te.delete("pickProductId"),te.delete("index");const ue=te.toString();H(`${O().url.pathname}${ue?"?"+ue:""}`,{replaceState:!0,noScroll:!0,keepFocus:!0})}}}),Ct(),St();var Oe=xr(),qe=Ne(Oe);Ut(qe,{title:"新建销售单",showBack:!0,backgroundColor:"bg-red-500",$$slots:{actions:(s,i)=>{var u=Vt(),g=a(u);r(u),k(()=>g.disabled=e(se)),$("click",g,()=>Ae("draft")),f(s,u)}}});var vt=n(qe,2);{var ct=s=>{var i=_r(),u=Ne(i),g=a(u);{var y=l=>{var o=Tt(),m=a(o),I=a(m,!0);r(m),r(o),k(()=>_(I,(e(d),v(()=>e(d).general)))),f(l,o)};w(g,l=>{e(d),v(()=>e(d).general)&&l(y)})}var te=n(g,2);{var ue=l=>{var o=Yt(),m=n(a(o),2);be(m,5,()=>(e(d),v(()=>Object.entries(e(d)))),_e,(I,N)=>{var q=Dt(()=>Ot(e(N),2));let L=()=>e(q)[0],U=()=>e(q)[1];var P=At(),S=Ne(P);{var h=x=>{var M=Kt(),c=a(M);r(M),k(()=>_(c,`• ${U()??""}`)),f(x,M)};w(S,x=>{L()!=="general"&&x(h)})}f(I,P)}),r(m),r(o),f(l,o)};w(te,l=>{e(d),v(()=>Object.keys(e(d)).length>1||Object.keys(e(d)).length===1&&!e(d).general)&&l(ue)})}var ie=n(te,2),we=a(ie),ke=n(a(we),2),ut=a(ke,!0);r(ke),r(we);var Le=n(we,2);{var mt=l=>{var o=Wt(),m=a(o),I=a(m,!0);r(m);var N=n(m,2);{var q=P=>{var S=Gt(),h=a(S,!0);r(S),k(()=>_(h,(e(t),v(()=>e(t).customerInfo.phone)))),f(P,S)};w(N,P=>{e(t),v(()=>e(t).customerInfo.phone)&&P(q)})}var L=n(N,2);{var U=P=>{var S=Qt(),h=a(S,!0);r(S),k(()=>_(h,(e(t),v(()=>e(t).customerInfo.address)))),f(P,S)};w(L,P=>{e(t),v(()=>e(t).customerInfo.address)&&P(U)})}r(o),k(()=>_(I,(e(t),v(()=>e(t).customerInfo.name)))),f(l,o)},ft=l=>{var o=Xt();$("click",o,()=>B(oe,!0)),f(l,o)};w(Le,l=>{e(t),v(()=>{var o,m;return(m=(o=e(t))==null?void 0:o.customerInfo)==null?void 0:m.name})?l(mt):l(ft,!1)})}var pt=n(Le,2);{var gt=l=>{var o=Zt(),m=a(o,!0);r(o),k(()=>_(m,(e(d),v(()=>e(d).customer)))),f(l,o)};w(pt,l=>{e(d),v(()=>e(d).customer)&&l(gt)})}r(ie);var Ie=n(ie,2),$e=n(a(Ie),2),Fe=n(a($e),2);le(Fe),r($e);var Pe=n($e,2),me=n(a(Pe),2);le(me);var bt=n(me,2);{var _t=l=>{var o=er(),m=a(o,!0);r(o),k(()=>_(m,(e(d),v(()=>e(d).createdBy)))),f(l,o)};w(bt,l=>{e(d),v(()=>e(d).createdBy)&&l(_t)})}r(Pe);var Ue=n(Pe,2),ze=n(a(Ue),2);le(ze),r(Ue),r(Ie);var Se=n(Ie,2),Be=a(Se),xt=n(a(Be),2);r(Be);var He=n(Be,2);{var yt=l=>{var o=tr(),m=a(o,!0);r(o),k(()=>_(m,(e(d),v(()=>e(d).items)))),f(l,o)};w(He,l=>{e(d),v(()=>e(d).items)&&l(yt)})}var je=n(He,2);be(je,5,()=>(e(t),v(()=>e(t).items)),_e,(l,o,m)=>{var I=sr(),N=a(I),q=a(N),L=a(q),U=a(L),P=a(U,!0);r(U);var S=n(U,2);{var h=C=>{var G=rr(),D=a(G);r(G),k(()=>_(D,`规格: ${e(o),v(()=>e(o).specification)??""}`)),f(C,G)};w(S,C=>{e(o),v(()=>e(o).specification)&&C(h)})}var x=n(S,2),M=a(x);r(x),r(L),r(q);var c=n(q,2),F=a(c),J=n(F,2),Z=n(J,2);{var T=C=>{var G=ar();$("click",G,()=>nt(m)),f(C,G)};w(Z,C=>{e(t),v(()=>e(t).items.length>1)&&C(T)})}r(c),r(N);var re=n(N,2),K=a(re),ee=n(a(K),2);le(ee),r(K);var j=n(K,2),A=n(a(j),2);le(A),r(j);var Y=n(j,2),pe=n(a(Y),2),ge=a(pe,!0);r(pe),r(Y),r(re),r(I),k(C=>{_(P,(e(o),v(()=>e(o).productName||"未选择商品"))),_(M,`单位: ${e(o),v(()=>e(o).unit)??""}`),_(ge,C)},[()=>(e(o),v(()=>De(e(o).amount)))]),$("click",F,()=>it(m)),$("click",J,()=>dt(m)),ae(ee,()=>e(o).quantity,C=>(e(o).quantity=C,Qe(()=>e(t)))),$("input",ee,()=>he(m)),ae(A,()=>e(o).unitPrice,C=>(e(o).unitPrice=C,Qe(()=>e(t)))),$("input",A,()=>he(m)),f(l,I)}),r(je);var Je=n(je,2),Ee=a(Je),Re=n(a(Ee),2),ht=a(Re,!0);r(Re),r(Ee),r(Je),r(Se);var Ce=n(Se,2),Ve=n(a(Ce),2);Mt(Ve),r(Ce);var Te=n(Ce,2),Ke=a(Te),fe=n(Ke,2),wt=a(fe,!0);r(fe),r(Te),r(u);var Ye=n(u,2);{var kt=l=>{var o=vr(),m=a(o),I=a(m),N=a(I),q=n(a(N),2);r(N),r(I);var L=n(I,2),U=a(L);{var P=h=>{var x=or(),M=n(a(x),2);r(x),$("click",M,()=>H("/mobile/customers/new")),f(h,x)},S=h=>{var x=lr();be(x,5,()=>e(R),_e,(M,c)=>{var F=dr(),J=a(F),Z=a(J,!0);r(J);var T=n(J,2);{var re=j=>{var A=ir(),Y=a(A,!0);r(A),k(()=>_(Y,(e(c),v(()=>e(c).phone)))),f(j,A)};w(T,j=>{e(c),v(()=>e(c).phone)&&j(re)})}var K=n(T,2);{var ee=j=>{var A=nr(),Y=a(A,!0);r(A),k(()=>_(Y,(e(c),v(()=>e(c).category)))),f(j,A)};w(K,j=>{e(c),v(()=>e(c).category)&&j(ee)})}r(F),k(()=>_(Z,(e(c),v(()=>e(c).name)))),$("click",F,()=>ye(e(c))),f(M,F)}),r(x),f(h,x)};w(U,h=>{e(R),v(()=>e(R).length===0)?h(P):h(S,!1)})}r(L),r(m),r(o),$("click",q,()=>B(oe,!1)),f(l,o)};w(Ye,l=>{e(oe)&&l(kt)})}var It=n(Ye,2);{var $t=l=>{var o=br(),m=a(o),I=a(m),N=a(I),q=n(a(N),2);r(N),r(I);var L=n(I,2),U=a(L);{var P=h=>{var x=cr(),M=n(a(x),2);r(x),$("click",M,()=>H("/mobile/products/new")),f(h,x)},S=h=>{var x=gr();be(x,5,()=>e(W),_e,(M,c)=>{var F=pr(),J=a(F),Z=a(J),T=a(Z),re=a(T,!0);r(T);var K=n(T,2);{var ee=D=>{var z=ur(),ne=a(z,!0);r(z),k(()=>_(ne,(e(c),v(()=>e(c).category)))),f(D,z)};w(K,D=>{e(c),v(()=>e(c).category)&&D(ee)})}var j=n(K,2),A=a(j);r(j);var Y=n(j,2);{var pe=D=>{var z=mr(),ne=a(z);r(z),k(E=>_(ne,`规格: ${E??""}`),[()=>(e(c),v(()=>{var E,de;return((E=e(c).specifications.find(Pt=>Pt.isDefault))==null?void 0:E.name)||((de=e(c).specifications[0])==null?void 0:de.name)||"无"}))]),f(D,z)};w(Y,D=>{e(c),v(()=>e(c).specifications.length>0)&&D(pe)})}r(Z);var ge=n(Z,2),C=a(ge);{var G=D=>{var z=fr(),ne=a(z);r(z),k(E=>_(ne,`¥${E??""}`),[()=>(e(c),v(()=>{var E;return((E=e(c).prices.find(de=>de.type==="sale"&&de.isDefault)||e(c).prices[0])==null?void 0:E.price.toFixed(2))||"0.00"}))]),f(D,z)};w(C,D=>{e(c),v(()=>e(c).prices.length>0)&&D(G)})}r(ge),r(J),r(F),k(()=>{_(re,(e(c),v(()=>e(c).name))),_(A,`单位: ${e(c),v(()=>e(c).unit)??""}`)}),$("click",F,()=>Me(e(c))),f(M,F)}),r(x),f(h,x)};w(U,h=>{e(W),v(()=>e(W).length===0)?h(P):h(S,!1)})}r(L),r(m),r(o),$("click",q,()=>B(xe,!1)),f(l,o)};w(It,l=>{e(xe)&&l($t)})}k(l=>{_(ut,(e(t),v(()=>{var o,m;return(m=(o=e(t))==null?void 0:o.customerInfo)!=null&&m.name?"更换客户":"选择客户"}))),qt(me,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent
               ${e(d),v(()=>e(d).createdBy?"border-red-500":"")??""}`),_(ht,l),fe.disabled=e(se),_(wt,e(se)?"保存中...":"保存")},[()=>(e(t),v(()=>De(e(t).totalAmount)))]),$("click",ke,()=>B(oe,!0)),ae(Fe,()=>e(t).date,l=>b(t,e(t).date=l)),ae(me,()=>e(t).createdBy,l=>b(t,e(t).createdBy=l)),ae(ze,()=>e(t).deliveryDate,l=>b(t,e(t).deliveryDate=l)),$("click",xt,ot),ae(Ve,()=>e(t).notes,l=>b(t,e(t).notes=l)),$("click",Ke,()=>H("/mobile/sales")),$("click",fe,()=>Ae("draft")),f(s,i)};w(vt,s=>{e(t)&&s(ct)})}f(Xe,Oe),Nt(),tt()}export{Dr as component};
