# è§†é¢‘å»æ°´å°åŠŸèƒ½è¯´æ˜

## ğŸ“± åŠŸèƒ½æ¦‚è¿°

å·²æˆåŠŸé›†æˆè§†é¢‘å»æ°´å°åŠŸèƒ½åˆ°åº”ç”¨ä¸­,æ”¯æŒå°†æŠ–éŸ³ã€å¿«æ‰‹ã€å°çº¢ä¹¦ã€TikTok ç­‰å¹³å°çš„è§†é¢‘ä¸‹è½½å¹¶ä¿å­˜åˆ°æ‰‹æœºæœ¬åœ°å­˜å‚¨ã€‚

---

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. å‰ç«¯åŠŸèƒ½
- âœ… æ–°å¢"å·¥å…·"é¡µé¢ (`/mobile/tools`)
- âœ… åº•éƒ¨å¯¼èˆªæ æ·»åŠ "å·¥å…·"å…¥å£
- âœ… æ”¯æŒå¤šå¹³å°è§†é¢‘è§£æ(æŠ–éŸ³ã€å¿«æ‰‹ã€å°çº¢ä¹¦ã€TikTok)
- âœ… è§†é¢‘é¢„è§ˆæ’­æ”¾
- âœ… ä¸€é”®ç²˜è´´å‰ªè´´æ¿é“¾æ¥
- âœ… ä¸‹è½½è¿›åº¦æ˜¾ç¤º
- âœ… ä¿å­˜æˆåŠŸæç¤º(æ˜¾ç¤ºæ–‡ä»¶è·¯å¾„)

### 2. åç«¯åŠŸèƒ½
- âœ… Rust å‘½ä»¤ `download_video` - ä¸‹è½½è§†é¢‘åˆ°æ‰‹æœº
- âœ… è‡ªåŠ¨æ£€æµ‹å¹³å°(Android/Desktop)
- âœ… Android: ä¿å­˜åˆ° `/storage/emulated/0/Download` ç›®å½•
- âœ… Desktop: ä¿å­˜åˆ°ç³»ç»Ÿä¸‹è½½ç›®å½•
- âœ… æ·»åŠ å­˜å‚¨æƒé™åˆ° AndroidManifest.xml

### 3. æŠ€æœ¯å®ç°
- âœ… ä½¿ç”¨ Tauri çš„ `invoke` è°ƒç”¨ Rust å‘½ä»¤
- âœ… ä½¿ç”¨ `reqwest` ä¸‹è½½è§†é¢‘æ–‡ä»¶
- âœ… ä½¿ç”¨ `dirs` è·å–ç³»ç»Ÿç›®å½•
- âœ… æµè§ˆå™¨ç¯å¢ƒé™çº§å¤„ç†(ä½¿ç”¨ä¼ ç»Ÿä¸‹è½½æ–¹å¼)

---

## ğŸ“‚ ä¿®æ”¹çš„æ–‡ä»¶

### å‰ç«¯æ–‡ä»¶
1. **`src/routes/mobile/tools/+page.svelte`** - å·¥å…·é¡µé¢
2. **`src/lib/services/videoParser.ts`** - è§†é¢‘è§£ææœåŠ¡
3. **`src/lib/components/MobileLayout.svelte`** - åº•éƒ¨å¯¼èˆªæ 

### åç«¯æ–‡ä»¶
1. **`src-tauri/src/lib.rs`** - æ·»åŠ  `download_video` å‘½ä»¤
2. **`src-tauri/Cargo.toml`** - æ·»åŠ ä¾èµ– `reqwest`, `dirs`
3. **`src-tauri/gen/android/app/src/main/AndroidManifest.xml`** - æ·»åŠ å­˜å‚¨æƒé™

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åœ¨æ‰‹æœºä¸Šä½¿ç”¨

1. **æ‰“å¼€æŠ–éŸ³/å¿«æ‰‹ç­‰ APP**
   - æ‰¾åˆ°æƒ³è¦ä¸‹è½½çš„è§†é¢‘
   - ç‚¹å‡»åˆ†äº«æŒ‰é’®
   - é€‰æ‹©"å¤åˆ¶é“¾æ¥"

2. **æ‰“å¼€æœ¬åº”ç”¨**
   - ç‚¹å‡»åº•éƒ¨å¯¼èˆªæ çš„"å·¥å…·"(é½¿è½®å›¾æ ‡)
   - ç‚¹å‡»"ç²˜è´´"æŒ‰é’®(æˆ–è‡ªåŠ¨å¡«å……)
   - ç‚¹å‡»"è§£æè§†é¢‘"

3. **ä¸‹è½½è§†é¢‘**
   - é¢„è§ˆè§†é¢‘å†…å®¹
   - ç‚¹å‡»"ğŸ’¾ ä¿å­˜åˆ°æ‰‹æœº"
   - ç­‰å¾…ä¸‹è½½å®Œæˆ
   - æŸ¥çœ‹ä¿å­˜è·¯å¾„æç¤º

4. **æŸ¥çœ‹è§†é¢‘**
   - æ‰“å¼€æ‰‹æœºçš„"æ–‡ä»¶ç®¡ç†å™¨"
   - è¿›å…¥"Download"æ–‡ä»¶å¤¹
   - æ‰¾åˆ°ä¸‹è½½çš„è§†é¢‘æ–‡ä»¶

---

## ğŸ“± Android ä¿å­˜ä½ç½®

è§†é¢‘ä¼šä¿å­˜åˆ°:
```
/storage/emulated/0/Download/è§†é¢‘æ ‡é¢˜.mp4
```

è¿™æ˜¯ Android ç³»ç»Ÿçš„æ ‡å‡†ä¸‹è½½ç›®å½•,å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®:
- æ–‡ä»¶ç®¡ç†å™¨ â†’ Download æ–‡ä»¶å¤¹
- ç›¸å†Œ â†’ è§†é¢‘(éƒ¨åˆ†æ‰‹æœºä¼šè‡ªåŠ¨æ‰«æ)

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### Rust å‘½ä»¤å®ç°

```rust
#[tauri::command]
async fn download_video(url: String, filename: String) -> Result<String, String> {
    // 1. ä¸‹è½½è§†é¢‘
    let response = reqwest::get(&url).await?;
    let bytes = response.bytes().await?;

    // 2. è·å–ä¸‹è½½ç›®å½•
    #[cfg(target_os = "android")]
    let download_dir = PathBuf::from("/storage/emulated/0/Download");
    
    #[cfg(not(target_os = "android"))]
    let download_dir = dirs::download_dir().ok_or("æ— æ³•è·å–ä¸‹è½½ç›®å½•")?;

    // 3. ä¿å­˜æ–‡ä»¶
    let file_path = download_dir.join(&filename);
    fs::write(&file_path, bytes)?;

    Ok(file_path.to_string_lossy().to_string())
}
```

### å‰ç«¯è°ƒç”¨

```typescript
const { invoke } = await import('@tauri-apps/api/core');

const filePath = await invoke<string>('download_video', {
    url: videoUrl,
    filename: filename
});
```

---

## ğŸ” æƒé™è¯´æ˜

### Android æƒé™

åœ¨ `AndroidManifest.xml` ä¸­æ·»åŠ äº†ä»¥ä¸‹æƒé™:

```xml
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
```

è¿™äº›æƒé™å…è®¸åº”ç”¨:
- å†™å…¥å¤–éƒ¨å­˜å‚¨(ä¿å­˜è§†é¢‘)
- è¯»å–å¤–éƒ¨å­˜å‚¨(è®¿é—®ä¸‹è½½ç›®å½•)

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å»ºè®®çš„æ”¹è¿›

1. **æƒé™è¯·æ±‚**
   - åœ¨ Android 11+ ä¸Š,éœ€è¦åŠ¨æ€è¯·æ±‚å­˜å‚¨æƒé™
   - å¯ä»¥ä½¿ç”¨ Tauri çš„æƒé™æ’ä»¶

2. **ä¸‹è½½ç®¡ç†**
   - æ·»åŠ ä¸‹è½½å†å²è®°å½•
   - æ”¯æŒæ‰¹é‡ä¸‹è½½
   - æ”¯æŒæ–­ç‚¹ç»­ä¼ 

3. **è§†é¢‘ç®¡ç†**
   - åœ¨åº”ç”¨å†…æŸ¥çœ‹å·²ä¸‹è½½çš„è§†é¢‘
   - æ”¯æŒåˆ é™¤ã€åˆ†äº«è§†é¢‘
   - è§†é¢‘æ’­æ”¾å™¨

4. **æ›´å¤šå¹³å°**
   - æ”¯æŒ Bç«™ã€å¾®åšç­‰æ›´å¤šå¹³å°
   - æ”¯æŒå›¾ç‰‡ä¸‹è½½
   - æ”¯æŒéŸ³é¢‘æå–

---

## ğŸ› å·²çŸ¥é—®é¢˜

1. **Android 11+ å­˜å‚¨æƒé™**
   - Android 11 åŠä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨äº†åˆ†åŒºå­˜å‚¨
   - å¯èƒ½éœ€è¦é¢å¤–çš„æƒé™é…ç½®

2. **å¤§æ–‡ä»¶ä¸‹è½½**
   - ç›®å‰æ²¡æœ‰ä¸‹è½½è¿›åº¦å›è°ƒ
   - å¤§æ–‡ä»¶ä¸‹è½½æ—¶å¯èƒ½çœ‹èµ·æ¥å¡ä½

3. **ç½‘ç»œé—®é¢˜**
   - è§£æ API å¯èƒ½ä¼šå¤±è´¥
   - å·²å®ç°å¤š API å¤‡ä»½æœºåˆ¶

---

## ğŸ“ æµ‹è¯•æ¸…å•

### æµè§ˆå™¨æµ‹è¯•
- [x] é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [x] ç²˜è´´é“¾æ¥åŠŸèƒ½
- [x] è§£æè§†é¢‘åŠŸèƒ½
- [x] è§†é¢‘é¢„è§ˆæ’­æ”¾
- [x] å¤åˆ¶é“¾æ¥åŠŸèƒ½
- [ ] ä¸‹è½½åŠŸèƒ½(æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨ä¼ ç»Ÿæ–¹å¼)

### Android æµ‹è¯•
- [ ] å®‰è£… APK
- [ ] æ‰“å¼€å·¥å…·é¡µé¢
- [ ] è§£ææŠ–éŸ³è§†é¢‘
- [ ] ä¿å­˜è§†é¢‘åˆ°æ‰‹æœº
- [ ] éªŒè¯æ–‡ä»¶ä¿å­˜ä½ç½®
- [ ] åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æŸ¥çœ‹è§†é¢‘
- [ ] æ’­æ”¾ä¸‹è½½çš„è§†é¢‘

---

## ğŸ”¨ æ„å»º Android APK

```bash
# 1. æ„å»º APK
npm run android:build

# 2. ç­¾å APK
/Users/zdp/Library/Android/sdk/build-tools/35.0.0/apksigner sign \
  --ks release.keystore \
  --ks-key-alias cypridina \
  --ks-pass pass:123456 \
  --key-pass pass:123456 \
  --out cypridina-sales-signed.apk \
  src-tauri/gen/android/app/build/outputs/apk/universal/release/app-universal-release-unsigned.apk

# 3. éªŒè¯ç­¾å
/Users/zdp/Library/Android/sdk/build-tools/35.0.0/apksigner verify --verbose cypridina-sales-signed.apk

# 4. å®‰è£…åˆ°æ‰‹æœº
adb install cypridina-sales-signed.apk
```

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æ£€æŸ¥:
1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. è§†é¢‘é“¾æ¥æ˜¯å¦æœ‰æ•ˆ
3. æ‰‹æœºå­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³
4. æ˜¯å¦æˆäºˆäº†å­˜å‚¨æƒé™

---

**æœ€åæ›´æ–°**: 2025-11-01
**ç‰ˆæœ¬**: v1.0.0

