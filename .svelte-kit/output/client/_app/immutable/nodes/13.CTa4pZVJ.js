import"../chunks/Bzak7iHL.js";import{i as da}from"../chunks/XlqFUZ3x.js";import{p as ca,o as la,l as va,i as fa,f as v,a as pa,g as a,b as l,c as ua,h as i,k,e as U,s as u,n as ga,r as o,u as n,t as x,d as g,j as ma}from"../chunks/nbkepknC.js";import{i as b}from"../chunks/BcVSc5tD.js";import{e as q,i as A}from"../chunks/DVrF0WE5.js";import{r as _a,s as xa}from"../chunks/2WVzPzKa.js";import{b as ba}from"../chunks/fLdq3W06.js";import{s as ha,a as ya}from"../chunks/D_8yISCJ.js";import{M as wa}from"../chunks/4cH0hlCX.js";import{g as ka}from"../chunks/D9O0WCOO.js";import{p as $a}from"../chunks/CfvlGoBy.js";var Ca=v('<div class="text-center text-gray-500 py-12">没有匹配的产品</div>'),Ia=v("<span> </span>"),La=v("<span> </span>"),Ma=v('<span class="text-orange-600"> </span>'),Pa=v('<span class="font-mono text-xs text-gray-500"> </span>'),ja=v('<span class="inline-block bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded"> </span>'),Sa=v('<div class="flex flex-wrap gap-1 mt-2"></div>'),za=v('<button class="w-full text-left bg-white rounded-lg p-4 shadow-sm border hover:shadow-md transition-shadow"><div class="flex items-start justify-between"><div class="flex-1"><div class="font-medium text-gray-900"> </div> <div class="text-sm text-gray-600 mt-1 flex flex-wrap gap-x-3 gap-y-1"><!> <span> </span> <!> <!> <!></div> <!></div></div></button>'),Ba=v('<div class="space-y-2"></div>'),Da=v('<!> <div class="bg-white border-b border-gray-200 p-3 sticky top-0 z-10"><div class="relative"><input type="text" placeholder="搜索产品名称、分类、条码、标签" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/> <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></div> <div class="p-3"><!></div>',1);function Ka(E,G){ca(G,!1);const P=()=>ya($a,"$page",K),[K,Q]=ha();let y=[],m=U([]),w=U("");la(()=>{T()});const T=()=>{try{const t=localStorage.getItem("products");y=t?JSON.parse(t):[],k(m,y),j()}catch(t){console.error("加载产品失败",t)}},j=()=>{if(!a(w).trim()){k(m,y);return}const t=a(w).toLowerCase();k(m,y.filter(d=>d.name.toLowerCase().includes(t)||d.category.toLowerCase().includes(t)||(d.barcode||"").toLowerCase().includes(t)||d.tags.some(_=>_.toLowerCase().includes(t))))},V=t=>{const d=Number(P().url.searchParams.get("index")||-1),_=P().url.searchParams.get("customerId");ka(`/mobile/sales/new?pickProductId=${encodeURIComponent(t)}&index=${d}${_?`&customerId=${_}`:""}`)};va(()=>{},()=>{j()}),fa(),da();var S=Da(),z=pa(S);wa(z,{title:"选择产品",showBack:!0,backgroundColor:"bg-orange-500"});var $=u(z,2),B=i($),D=i(B);_a(D),ga(2),o(B),o($);var N=u($,2),W=i(N);{var X=t=>{var d=Ca();l(t,d)},Y=t=>{var d=Ba();q(d,5,()=>a(m),A,(_,e)=>{var h=za(),F=i(h),H=i(F),C=i(H),Z=i(C,!0);o(C);var I=u(C,2),J=i(I);{var aa=r=>{var s=Ia(),f=i(s);o(s),x(()=>g(f,`分类: ${a(e),n(()=>a(e).category)??""}`)),l(r,s)};b(J,r=>{a(e),n(()=>a(e).category)&&r(aa)})}var L=u(J,2),ea=i(L);o(L);var O=u(L,2);{var ta=r=>{var s=La(),f=i(s);o(s),x(c=>g(f,`规格: ${c??""}`),[()=>(a(e),n(()=>{var c,p;return((c=a(e).specifications.find(M=>M.isDefault))==null?void 0:c.name)||((p=a(e).specifications[0])==null?void 0:p.name)}))]),l(r,s)};b(O,r=>{a(e),n(()=>a(e).specifications.length>0)&&r(ta)})}var R=u(O,2);{var ra=r=>{var s=Ma(),f=i(s);o(s),x(c=>g(f,`¥${c??""}`),[()=>(a(e),n(()=>{var c;return(c=a(e).prices.find(p=>p.type==="sale"&&p.isDefault)||a(e).prices[0])==null?void 0:c.price.toFixed(2)}))]),l(r,s)};b(R,r=>{a(e),n(()=>a(e).prices.length>0)&&r(ra)})}var sa=u(R,2);{var oa=r=>{var s=Pa(),f=i(s,!0);o(s),x(()=>g(f,(a(e),n(()=>a(e).barcode)))),l(r,s)};b(sa,r=>{a(e),n(()=>a(e).barcode)&&r(oa)})}o(I);var ia=u(I,2);{var na=r=>{var s=Sa();q(s,5,()=>(a(e),n(()=>a(e).tags.slice(0,4))),A,(f,c)=>{var p=ja(),M=i(p,!0);o(p),x(()=>g(M,a(c))),l(f,p)}),o(s),l(r,s)};b(ia,r=>{a(e),n(()=>a(e).tags.length>0)&&r(na)})}o(H),o(F),o(h),x(()=>{xa(h,"aria-label",(a(e),n(()=>`选择 ${a(e).name}`))),g(Z,(a(e),n(()=>a(e).name))),g(ea,`单位: ${a(e),n(()=>a(e).unit)??""}`)}),ma("click",h,()=>V(a(e).id)),l(_,h)}),o(d),l(t,d)};b(W,t=>{a(m),n(()=>a(m).length===0)?t(X):t(Y,!1)})}o(N),ba(D,()=>a(w),t=>k(w,t)),l(E,S),ua(),Q()}export{Ka as component};
