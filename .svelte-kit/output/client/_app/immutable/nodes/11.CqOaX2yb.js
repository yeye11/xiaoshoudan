import"../chunks/Bzak7iHL.js";import{i as Kt}from"../chunks/BvNKmLqF.js";import{p as Lt,o as Qt,f as h,a as Rt,t as A,b as f,c as Ut,s as o,g as d,m as D,j as c,i as e,d as g,k as R,r as t,n as gt}from"../chunks/D2QV5ZPr.js";import{i as _t}from"../chunks/BvOdW7jM.js";import{e as U,i as V}from"../chunks/IKNvqO1Y.js";import{s as Vt}from"../chunks/DaZe8rAl.js";import{M as Wt}from"../chunks/DO-NYQEs.js";var Xt=h('<div class="flex items-center justify-between"><span class="text-sm text-gray-600"> </span> <div class="flex items-center space-x-2"><div class="w-20 bg-gray-200 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full"></div></div> <span class="text-sm font-medium text-gray-900 w-16 text-right"> </span></div></div>'),Zt=h('<p class="text-gray-500 text-center py-4">暂无数据</p>'),te=h('<div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-6 h-6 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center font-medium"></div> <div><div class="font-medium text-gray-900"> </div> <div class="text-xs text-gray-500"> </div></div></div> <div class="text-right"><div class="font-medium text-gray-900"> </div></div></div>'),ee=h('<div class="space-y-3"></div>'),ae=h('<p class="text-gray-500 text-center py-4">暂无数据</p>'),se=h('<div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-6 h-6 rounded-full bg-orange-500 text-white text-xs flex items-center justify-center font-medium"></div> <div><div class="font-medium text-gray-900"> </div> <div class="text-xs text-gray-500"> </div></div></div> <div class="text-right"><div class="font-medium text-gray-900"> </div></div></div>'),re=h('<div class="space-y-3"></div>'),de=h('<!> <div class="p-4 space-y-6"><div class="grid grid-cols-2 gap-4"><div class="bg-white rounded-lg p-4 shadow-sm border"><div class="text-sm text-gray-500">今日销售</div> <div class="text-2xl font-bold text-green-600"> </div> <div class="text-xs text-gray-400 mt-1"> </div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><div class="text-sm text-gray-500">总欠款</div> <div class="text-2xl font-bold text-red-600"> </div> <div class="text-xs text-gray-400 mt-1"> </div></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><h3 class="font-medium text-gray-900 mb-4">销售统计</h3> <div class="grid grid-cols-2 gap-4"><div class="text-center"><div class="text-lg font-bold text-gray-900"> </div> <div class="text-sm text-gray-500">本周销售</div></div> <div class="text-center"><div class="text-lg font-bold text-gray-900"> </div> <div class="text-sm text-gray-500">本年销售</div></div></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><h3 class="font-medium text-gray-900 mb-4">近7天销售趋势</h3> <div class="space-y-2"></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><h3 class="font-medium text-gray-900 mb-4">客户排行榜</h3> <!></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><h3 class="font-medium text-gray-900 mb-4">产品排行榜</h3> <!></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><h3 class="font-medium text-gray-900 mb-4">业务概览</h3> <div class="grid grid-cols-2 gap-4"><div class="text-center"><div class="text-lg font-bold text-blue-600"> </div> <div class="text-sm text-gray-500">总客户数</div> <div class="text-xs text-gray-400"> </div></div> <div class="text-center"><div class="text-lg font-bold text-orange-600"> </div> <div class="text-sm text-gray-500">总产品数</div> <div class="text-xs text-gray-400"> </div></div> <div class="text-center"><div class="text-lg font-bold text-green-600"> </div> <div class="text-sm text-gray-500">总订单数</div> <div class="text-xs text-gray-400"> </div></div> <div class="text-center"><div class="text-lg font-bold text-red-600"> </div> <div class="text-sm text-gray-500">未付订单</div> <div class="text-xs text-gray-400"> </div></div></div></div></div>',1);function me(pt,ft){Lt(ft,!1);let i=D({totalSales:0,todaySales:0,weekSales:0,monthSales:0,yearSales:0,totalCustomers:0,activeCustomers:0,totalDebt:0,totalProducts:0,activeProducts:0,totalOrders:0,paidOrders:0,unpaidOrders:0,draftOrders:0}),C=D([]),I=D([]),T=D([]);Qt(()=>{ht()});const ht=()=>{try{const s=JSON.parse(localStorage.getItem("invoice_history")||"[]"),v=JSON.parse(localStorage.getItem("customers")||"[]"),l=JSON.parse(localStorage.getItem("products")||"[]");yt(s,v,l),bt(s),St(s),wt(s)}catch(s){console.error("加载统计数据失败:",s)}},yt=(s,v,l)=>{const r=new Date,u=r.toISOString().split("T")[0],m=new Date(r.getTime()-10080*60*1e3).toISOString().split("T")[0],x=new Date(r.getFullYear(),r.getMonth(),1).toISOString().split("T")[0],_=new Date(r.getFullYear(),0,1).toISOString().split("T")[0];g(i,d(i).totalSales=s.reduce((a,n)=>a+n.totalAmount,0)),g(i,d(i).todaySales=s.filter(a=>a.date===u).reduce((a,n)=>a+n.totalAmount,0)),g(i,d(i).weekSales=s.filter(a=>a.date>=m).reduce((a,n)=>a+n.totalAmount,0)),g(i,d(i).monthSales=s.filter(a=>a.date>=x).reduce((a,n)=>a+n.totalAmount,0)),g(i,d(i).yearSales=s.filter(a=>a.date>=_).reduce((a,n)=>a+n.totalAmount,0)),g(i,d(i).totalCustomers=v.length),g(i,d(i).activeCustomers=v.filter(a=>a.isActive).length),g(i,d(i).totalDebt=v.reduce((a,n)=>a+n.initialDebt,0)+s.filter(a=>a.paymentStatus!=="paid").reduce((a,n)=>a+(n.totalAmount-n.paidAmount),0)),g(i,d(i).totalProducts=l.length),g(i,d(i).activeProducts=l.filter(a=>a.isActive).length),g(i,d(i).totalOrders=s.length),g(i,d(i).paidOrders=s.filter(a=>a.paymentStatus==="paid").length),g(i,d(i).unpaidOrders=s.filter(a=>a.paymentStatus==="unpaid").length),g(i,d(i).draftOrders=s.filter(a=>a.status==="draft").length)},bt=s=>{const v=[],l=new Date;for(let r=6;r>=0;r--){const m=new Date(l.getTime()-r*24*60*60*1e3).toISOString().split("T")[0],_=s.filter(a=>a.date===m).reduce((a,n)=>a+n.totalAmount,0);v.push({date:m,amount:_})}R(C,v)},St=s=>{const v=new Map;s.forEach(l=>{const r=l.customerInfo.name;if(v.has(r)){const u=v.get(r);u.amount+=l.totalAmount,u.count+=1}else v.set(r,{amount:l.totalAmount,count:1})}),R(I,Array.from(v.entries()).map(([l,r])=>({name:l,...r})).sort((l,r)=>r.amount-l.amount).slice(0,5))},wt=s=>{const v=new Map;s.forEach(l=>{l.items.forEach(r=>{if(v.has(r.productName)){const u=v.get(r.productName);u.amount+=r.amount,u.count+=r.quantity}else v.set(r.productName,{amount:r.amount,count:r.quantity})})}),R(T,Array.from(v.entries()).map(([l,r])=>({name:l,...r})).sort((l,r)=>r.amount-l.amount).slice(0,5))},p=s=>`¥${s.toFixed(2)}`,Ot=s=>{const v=new Date(s);return`${v.getMonth()+1}/${v.getDate()}`};Kt();var W=de(),X=Rt(W);Wt(X,{title:"数据",showBack:!0,backgroundColor:"bg-green-500"});var Z=o(X,2),M=e(Z),k=e(M),P=o(e(k),2),At=e(P,!0);t(P);var tt=o(P,2),Dt=e(tt);t(tt),t(k);var et=o(k,2),$=o(e(et),2),Ct=e($,!0);t($);var at=o($,2),It=e(at);t(at),t(et),t(M);var N=o(M,2),st=o(e(N),2),j=e(st),rt=e(j),Tt=e(rt,!0);t(rt),gt(2),t(j);var dt=o(j,2),it=e(dt),Mt=e(it,!0);t(it),gt(2),t(dt),t(st),t(N);var E=o(N,2),vt=o(e(E),2);U(vt,5,()=>d(C),V,(s,v)=>{var l=Xt(),r=e(l),u=e(r,!0);t(r);var m=o(r,2),x=e(m),_=e(x);t(x);var a=o(x,2),n=e(a,!0);t(a),t(m),t(l),A((y,b,S)=>{c(u,y),Vt(_,`width: ${b??""}%`),c(n,S)},[()=>Ot(d(v).date),()=>Math.max(5,d(v).amount/Math.max(...d(C).map(y=>y.amount))*100),()=>p(d(v).amount)]),f(s,l)}),t(vt),t(E);var F=o(E,2),kt=o(e(F),2);{var Pt=s=>{var v=Zt();f(s,v)},$t=s=>{var v=ee();U(v,5,()=>d(I),V,(l,r,u)=>{var m=te(),x=e(m),_=e(x);_.textContent=u+1;var a=o(_,2),n=e(a),y=e(n,!0);t(n);var b=o(n,2),S=e(b);t(b),t(a),t(x);var w=o(x,2),O=e(w),L=e(O,!0);t(O),t(w),t(m),A(Q=>{c(y,d(r).name),c(S,`${d(r).count??""} 笔订单`),c(L,Q)},[()=>p(d(r).amount)]),f(l,m)}),t(v),f(s,v)};_t(kt,s=>{d(I).length===0?s(Pt):s($t,!1)})}t(F);var J=o(F,2),Nt=o(e(J),2);{var jt=s=>{var v=ae();f(s,v)},Et=s=>{var v=re();U(v,5,()=>d(T),V,(l,r,u)=>{var m=se(),x=e(m),_=e(x);_.textContent=u+1;var a=o(_,2),n=e(a),y=e(n,!0);t(n);var b=o(n,2),S=e(b);t(b),t(a),t(x);var w=o(x,2),O=e(w),L=e(O,!0);t(O),t(w),t(m),A(Q=>{c(y,d(r).name),c(S,`销量: ${d(r).count??""}`),c(L,Q)},[()=>p(d(r).amount)]),f(l,m)}),t(v),f(s,v)};_t(Nt,s=>{d(T).length===0?s(jt):s(Et,!1)})}t(J);var ot=o(J,2),lt=o(e(ot),2),q=e(lt),B=e(q),Ft=e(B,!0);t(B);var nt=o(B,4),Jt=e(nt);t(nt),t(q);var Y=o(q,2),H=e(Y),qt=e(H,!0);t(H);var ct=o(H,4),Bt=e(ct);t(ct),t(Y);var z=o(Y,2),G=e(z),Yt=e(G,!0);t(G);var ut=o(G,4),Ht=e(ut);t(ut),t(z);var mt=o(z,2),K=e(mt),zt=e(K,!0);t(K);var xt=o(K,4),Gt=e(xt);t(xt),t(mt),t(lt),t(ot),t(Z),A((s,v,l,r,u)=>{c(At,s),c(Dt,`本月: ${v??""}`),c(Ct,l),c(It,`未付订单: ${d(i).unpaidOrders??""}`),c(Tt,r),c(Mt,u),c(Ft,d(i).totalCustomers),c(Jt,`活跃: ${d(i).activeCustomers??""}`),c(qt,d(i).totalProducts),c(Bt,`在售: ${d(i).activeProducts??""}`),c(Yt,d(i).totalOrders),c(Ht,`已付: ${d(i).paidOrders??""}`),c(zt,d(i).unpaidOrders),c(Gt,`草稿: ${d(i).draftOrders??""}`)},[()=>p(d(i).todaySales),()=>p(d(i).monthSales),()=>p(d(i).totalDebt),()=>p(d(i).weekSales),()=>p(d(i).yearSales)]),f(pt,W),Ut()}export{me as component};
