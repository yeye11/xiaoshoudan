import"../chunks/Bzak7iHL.js";import{i as De}from"../chunks/BvNKmLqF.js";import{p as Be,o as Je,f as d,h as Oe,a as B,b as l,c as ze,$ as Ae,e as I,g as e,_ as se,s as o,i as a,k as M,m as J,r,y as ie,t as q,j as w}from"../chunks/D2QV5ZPr.js";import{i as u}from"../chunks/BvOdW7jM.js";import{s as Ee}from"../chunks/CdHOzu_t.js";import{s as ne}from"../chunks/Baws9BAC.js";import{s as Pe,a as Fe}from"../chunks/GeVYpaAz.js";import{M as Le}from"../chunks/DO-NYQEs.js";import{D as Ve}from"../chunks/Du_dmzzL.js";import{M as Ge}from"../chunks/DDWXNEKt.js";import{p as Ke}from"../chunks/D2SIzPNB.js";import{g as L}from"../chunks/BqcfPq16.js";var Qe=d('<button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="编辑"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button>'),Re=d('<div slot="actions"><!> <button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="打印"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg></button></div>'),Te=d('<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"></div> <p class="text-gray-500 mt-2">加载中...</p></div>'),Ue=d('<div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center"><p class="text-red-600"> </p> <button class="mt-2 bg-red-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors">返回销售单列表</button></div>'),We=d('<div class="text-sm text-gray-600"><span>未付金额:</span> <span class="ml-2 text-red-600 font-medium"> </span></div>'),Xe=d('<div class="flex justify-between"><span class="text-gray-600">联系电话:</span> <a class="text-blue-600 font-medium"> </a></div>'),Ye=d('<div class="flex justify-between"><span class="text-gray-600">地址:</span> <span class="font-medium text-right max-w-48"> </span></div>'),Ze=d('<div class="bg-white rounded-lg p-4 shadow-sm border svelte-1wqlfg8"><h3 class="font-medium text-gray-900 mb-3">客户信息</h3> <div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">客户名称:</span> <span class="font-medium"> </span></div> <!> <!></div></div>'),et=d('<button class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors">编辑送货单</button>'),tt=d('<button class="w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors">删除送货单</button>'),at=d('<div class="bg-white rounded-lg p-4 shadow-sm border svelte-1wqlfg8"><h3 class="font-medium text-gray-900 mb-3">保存选项</h3> <!></div> <div class="bg-white rounded-lg shadow-sm border overflow-hidden svelte-1wqlfg8"><!></div> <div class="bg-white rounded-lg p-4 shadow-sm border svelte-1wqlfg8"><div class="flex items-center justify-between mb-4"><h3 class="font-medium text-gray-900">单据状态</h3> <div class="flex space-x-2"><div> </div> <div> </div></div></div> <!></div> <!> <div class="bg-white rounded-lg p-4 shadow-sm border svelte-1wqlfg8"><h3 class="font-medium text-gray-900 mb-3">操作</h3> <div class="space-y-2"><!> <button class="w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition-colors">打印送货单</button> <!></div></div>',1),rt=d('<!> <div class="p-4 space-y-6 mobile-content svelte-1wqlfg8"><!></div>',1);function ft(le,de){Be(de,!1);const ve=()=>Fe(Ke,"$page",ce),[ce,ue]=Pe();let s=J(null),f=J(null),H,V=J(!0),N=J("");Je(()=>{H=ve().params.id||"",me()});const me=()=>{try{const t=localStorage.getItem("invoice_history");if(t){const v=JSON.parse(t);if(M(s,v.find(m=>m.id===H)||null),e(s)){const m=localStorage.getItem("customers");if(m){const g=JSON.parse(m);M(f,g.find(k=>{var c;return k.id===((c=e(s))==null?void 0:c.customerId)})||null)}}else M(N,"未找到指定的销售单")}else M(N,"没有找到销售单数据")}catch(t){console.error("加载销售单失败:",t),M(N,"加载销售单失败")}finally{M(V,!1)}},G=()=>{L(`/mobile/sales/${H}/edit`)},K=()=>{window.print()},ge=()=>{if(confirm("确定要删除这个销售单吗？"))try{const t=localStorage.getItem("invoice_history");if(t){const m=JSON.parse(t).filter(g=>g.id!==H);localStorage.setItem("invoice_history",JSON.stringify(m)),L("/mobile/sales")}}catch(t){console.error("删除销售单失败:",t),alert("删除失败，请重试")}},pe=t=>`¥${t.toFixed(2)}`,Q=t=>({draft:{name:"草稿",color:"bg-gray-100 text-gray-800"},confirmed:{name:"已确认",color:"bg-blue-100 text-blue-800"},delivered:{name:"已送货",color:"bg-green-100 text-green-800"},cancelled:{name:"已取消",color:"bg-red-100 text-red-800"}})[t]||{name:"未知",color:"bg-gray-100 text-gray-800"},R=t=>({unpaid:{name:"未付款",color:"bg-red-100 text-red-800"},partial:{name:"部分付款",color:"bg-yellow-100 text-yellow-800"},paid:{name:"已付款",color:"bg-green-100 text-green-800"}})[t]||{name:"未知",color:"bg-gray-100 text-gray-800"};De();var T=rt();Oe(t=>{Ae.title="送货单详情 - 仁腾装饰材料管理系统"});var U=B(T);{let t=se(()=>e(s)?`送货单 ${e(s).invoiceNumber}`:"送货单详情");Le(U,{get title(){return e(t)},showBack:!0,backgroundColor:"bg-green-500",$$slots:{actions:(v,m)=>{var g=Re(),k=a(g);{var c=p=>{var $=Qe();I("click",$,G),l(p,$)};u(k,p=>{e(s)&&e(s).status==="draft"&&p(c)})}var b=o(k,2);r(g),I("click",b,K),l(v,g)}}})}var W=o(U,2),fe=a(W);{var be=t=>{var v=Te();l(t,v)},_e=t=>{var v=ie(),m=B(v);{var g=c=>{var b=Ue(),p=a(b),$=a(p,!0);r(p);var j=o(p,2);r(b),q(()=>w($,e(N))),I("click",j,()=>L("/mobile/sales")),l(c,b)},k=c=>{var b=ie(),p=B(b);{var $=j=>{var X=at(),O=B(X),he=o(a(O),2);{let i=se(()=>`送货单-${e(s).invoiceNumber}`);Ge(he,{targetElement:null,get fileName(){return e(i)},showButton:!0})}r(O);var z=o(O,2),xe=a(z);Ve(xe,{get invoice(){return e(s)},showActions:!1}),r(z);var A=o(z,2),E=a(A),Y=o(a(E),2),C=a(Y),ye=a(C,!0);r(C);var P=o(C,2),we=a(P,!0);r(P),r(Y),r(E);var ke=o(E,2);{var $e=i=>{var n=We(),_=o(a(n),2),h=a(_,!0);r(_),r(n),q(D=>w(h,D),[()=>pe(e(s).totalAmount-e(s).paidAmount)]),l(i,n)};u(ke,i=>{e(s).paymentStatus!=="paid"&&i($e)})}r(A);var Z=o(A,2);{var Se=i=>{var n=Ze(),_=o(a(n),2),h=a(_),D=o(a(h),2),Ne=a(D,!0);r(D),r(h);var oe=o(h,2);{var je=x=>{var y=Xe(),S=o(a(y),2),F=a(S,!0);r(S),r(y),q(()=>{Ee(S,"href",`tel:${e(f).phone??""}`),w(F,e(f).phone)}),l(x,y)};u(oe,x=>{e(f).phone&&x(je)})}var He=o(oe,2);{var Ce=x=>{var y=Ye(),S=o(a(y),2),F=a(S,!0);r(S),r(y),q(()=>w(F,e(f).address)),l(x,y)};u(He,x=>{e(f).address&&x(Ce)})}r(_),r(n),q(()=>w(Ne,e(f).name)),l(i,n)};u(Z,i=>{e(f)&&i(Se)})}var ee=o(Z,2),te=o(a(ee),2),ae=a(te);{var Ie=i=>{var n=et();I("click",n,G),l(i,n)};u(ae,i=>{e(s).status==="draft"&&i(Ie)})}var re=o(ae,2),Me=o(re,2);{var qe=i=>{var n=tt();I("click",n,ge),l(i,n)};u(Me,i=>{e(s).status==="draft"&&i(qe)})}r(te),r(ee),q((i,n,_,h)=>{ne(C,1,`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${i??""}`,"svelte-1wqlfg8"),w(ye,n),ne(P,1,`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${_??""}`,"svelte-1wqlfg8"),w(we,h)},[()=>Q(e(s).status).color,()=>Q(e(s).status).name,()=>R(e(s).paymentStatus).color,()=>R(e(s).paymentStatus).name]),I("click",re,K),l(j,X)};u(p,j=>{e(s)&&j($)},!0)}l(c,b)};u(m,c=>{e(N)?c(g):c(k,!1)},!0)}l(t,v)};u(fe,t=>{e(V)?t(be):t(_e,!1)})}r(W),l(le,T),ze(),ue()}export{ft as component};
