import"../chunks/Bzak7iHL.js";import{i as Xt}from"../chunks/XlqFUZ3x.js";import{p as Yt,o as Zt,l as te,i as ee,q as gt,a as R,b as m,c as ae,g as t,e as $,k as y,f,h as r,s as n,r as a,j as _,u as d,n as re,t as I,d as p,m as pt}from"../chunks/nbkepknC.js";import{i as k}from"../chunks/BcVSc5tD.js";import{e as oe,i as se}from"../chunks/DVrF0WE5.js";import{s as U}from"../chunks/BYJuMw6P.js";import{s as ie,a as ne}from"../chunks/D_8yISCJ.js";import{M as le}from"../chunks/4cH0hlCX.js";import{p as de}from"../chunks/CfvlGoBy.js";import{g as O}from"../chunks/D9O0WCOO.js";var ve=f('<div class="flex items-center justify-center min-h-screen"><div class="text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div> <p class="text-gray-500">加载中...</p></div></div>'),ce=f('<div class="flex items-center justify-center min-h-screen"><div class="text-center"><p class="text-gray-500 mb-4">客户不存在</p> <button class="bg-blue-500 text-white px-4 py-2 rounded-lg">返回客户列表</button></div></div>'),ue=f('<button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="拨打电话"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg></button>'),me=f('<div slot="actions" class="flex space-x-2"><!> <button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="编辑"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button> <button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors" aria-label="更多"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg></button></div>'),ge=f('<span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mt-1"> </span>'),pe=f('<div class="flex items-center justify-between"><div class="flex items-center"><svg class="w-5 h-5 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg> <span class="text-gray-900"> </span></div> <button class="text-blue-500 text-sm font-medium">拨打</button></div>'),fe=f('<div class="flex items-center"><svg class="w-5 h-5 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg> <span class="text-gray-600"> </span></div>'),be=f('<div class="flex items-start"><svg class="w-5 h-5 text-gray-400 mr-3 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <span class="text-gray-600"> </span></div>'),he=f('<div class="flex items-center"><svg class="w-5 h-5 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg> <span class="text-gray-600"> </span></div>'),xe=f('<div class="p-8 text-center"><svg class="w-12 h-12 mx-auto text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <p class="text-gray-500">暂时没有数据哦~</p></div>'),_e=f('<div class="p-4 hover:bg-gray-50 cursor-pointer"><div class="flex items-center justify-between"><div><div class="font-medium text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></div> <div class="text-right"><div class="font-medium text-gray-900"> </div> <div> </div></div></div></div>'),ke=f('<div class="divide-y divide-gray-200"></div>'),ye=f('<!> <div class="p-4 space-y-4"><div class="bg-white rounded-lg p-4 shadow-sm border"><div class="flex items-start justify-between mb-4"><div><h2 class="text-xl font-bold text-gray-900"> </h2> <!></div> <div class="text-right"><div class="text-sm text-gray-500">总欠款</div> <div> </div></div></div> <div class="space-y-3"><!> <!> <!> <!></div></div> <div class="grid grid-cols-3 gap-3"><button class="bg-blue-500 text-white p-3 rounded-lg font-medium hover:bg-blue-600 transition-colors">创建销售单</button> <button class="bg-green-500 text-white p-3 rounded-lg font-medium hover:bg-green-600 transition-colors">对账</button> <button> </button></div> <div class="bg-white rounded-lg shadow-sm border"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">历史记录</h3> <div class="flex space-x-2"><button class="text-sm text-blue-500 font-medium"> </button> <button class="text-sm text-blue-500 font-medium">筛选</button></div></div></div> <!></div></div>',1);function De(ft,bt){Yt(bt,!1);const H=()=>ne(de,"$page",ht),[ht,xt]=ie(),g=$();let e=$(null),w=$([]),J=$(!0),V=$("date"),A=$("desc");Zt(()=>{console.log("客户详情页面加载 - customerId:",t(g)),console.log("客户详情页面加载 - page.params:",H().params),_t()});const _t=()=>{try{if(console.log("开始加载客户数据 - customerId:",t(g)),!t(g)||t(g)==="undefined"){console.error("客户ID无效:",t(g)),y(J,!1);return}const o=JSON.parse(localStorage.getItem("customers")||"[]");console.log("所有客户数据:",o),y(e,o.find(u=>u.id===t(g))||null),console.log("找到的客户:",t(e));const c=JSON.parse(localStorage.getItem("invoice_history")||"[]");y(w,c.filter(u=>{var b;return u.customerId===t(g)||u.customerInfo.name===((b=t(e))==null?void 0:b.name)})),console.log("客户相关销售单:",t(w)),W()}catch(o){console.error("加载客户数据失败:",o)}finally{y(J,!1)}},W=()=>{t(w).sort((o,c)=>{let u,b;switch(t(V)){case"date":u=new Date(o.date).getTime(),b=new Date(c.date).getTime();break;case"amount":u=o.totalAmount,b=c.totalAmount;break;default:return 0}return t(A)==="asc"?u-b:b-u})},X=()=>{if(!t(e))return 0;const o=t(w).filter(c=>c.paymentStatus!=="paid").reduce((c,u)=>c+(u.totalAmount-u.paidAmount),0);return t(e).initialDebt+o},kt=o=>new Date(o).toLocaleDateString("zh-CN"),Y=o=>`¥${o.toFixed(2)}`,Z=o=>o?o.replace(/(\d{3})(\d{4})(\d{4})/,"$1-$2-$3"):"",tt=o=>{o&&(window.location.href=`tel:${o}`)},yt=()=>{O(`/mobile/customers/${t(g)}/edit`)},wt=()=>{if(console.log("创建销售单 - customerId:",t(g)),console.log("创建销售单 - customer:",t(e)),!t(g)||t(g)==="undefined"){alert("客户ID无效，无法创建销售单");return}O(`/mobile/sales/new?customerId=${t(g)}`)},It=o=>{O(`/mobile/sales/${o}`)},et=o=>{t(V)===o?y(A,t(A)==="asc"?"desc":"asc"):(y(V,o),y(A,"desc")),W()},Ct=()=>{if(!t(e))return;if(confirm(t(e).isActive?"确定要禁用此客户吗？":"确定要启用此客户吗？")){pt(e,t(e).isActive=!t(e).isActive),pt(e,t(e).updatedAt=new Date().toISOString());const c=JSON.parse(localStorage.getItem("customers")||"[]"),u=c.findIndex(b=>b.id===t(g));u!==-1&&(c[u]=t(e),localStorage.setItem("customers",JSON.stringify(c)))}};te(()=>H(),()=>{y(g,H().params.id)}),ee(),Xt();var at=gt(),jt=R(at);{var Mt=o=>{var c=ve();m(o,c)},St=o=>{var c=gt(),u=R(c);{var b=C=>{var j=ce(),z=r(j),D=n(r(z),2);a(z),a(j),_("click",D,()=>O("/mobile/customers")),m(C,j)},$t=C=>{var j=ye(),z=R(j);le(z,{title:"客户详情",showBack:!0,showActions:!0,backgroundColor:"bg-blue-500",$$slots:{actions:(s,i)=>{var v=me(),l=r(v);{var h=x=>{var S=ue();_("click",S,()=>tt(t(e).phone)),m(x,S)};k(l,x=>{t(e),d(()=>t(e).phone)&&x(h)})}var M=n(l,2);re(2),a(v),_("click",M,yt),m(s,v)}}});var D=n(z,2),L=r(D),P=r(L),T=r(P),q=r(T),At=r(q,!0);a(q);var zt=n(q,2);{var Vt=s=>{var i=ge(),v=r(i,!0);a(i),I(()=>p(v,(t(e),d(()=>t(e).category)))),m(s,i)};k(zt,s=>{t(e),d(()=>t(e).category)&&s(Vt)})}a(T);var rt=n(T,2),E=n(r(rt),2),Dt=r(E,!0);a(E),a(rt),a(P);var ot=n(P,2),st=r(ot);{var Bt=s=>{var i=pe(),v=r(i),l=n(r(v),2),h=r(l,!0);a(l),a(v);var M=n(v,2);a(i),I(x=>p(h,x),[()=>(t(e),d(()=>Z(t(e).phone)))]),_("click",M,()=>tt(t(e).phone)),m(s,i)};k(st,s=>{t(e),d(()=>t(e).phone)&&s(Bt)})}var it=n(st,2);{var Nt=s=>{var i=fe(),v=n(r(i),2),l=r(v,!0);a(v),a(i),I(h=>p(l,h),[()=>(t(e),d(()=>Z(t(e).backupPhone)))]),m(s,i)};k(it,s=>{t(e),d(()=>t(e).backupPhone)&&s(Nt)})}var nt=n(it,2);{var Ot=s=>{var i=be(),v=n(r(i),2),l=r(v,!0);a(v),a(i),I(()=>p(l,(t(e),d(()=>t(e).address)))),m(s,i)};k(nt,s=>{t(e),d(()=>t(e).address)&&s(Ot)})}var Ht=n(nt,2);{var Jt=s=>{var i=he(),v=n(r(i),2),l=r(v,!0);a(v),a(i),I(()=>p(l,(t(e),d(()=>t(e).email)))),m(s,i)};k(Ht,s=>{t(e),d(()=>t(e).email)&&s(Jt)})}a(ot),a(L);var F=n(L,2),lt=r(F),B=n(lt,4),Lt=r(B,!0);a(B),a(F);var dt=n(F,2),G=r(dt),vt=r(G),ct=n(r(vt),2),N=r(ct),Pt=r(N);a(N);var Tt=n(N,2);a(ct),a(vt),a(G);var qt=n(G,2);{var Et=s=>{var i=xe();m(s,i)},Ft=s=>{var i=ke();oe(i,5,()=>t(w),se,(v,l)=>{var h=_e(),M=r(h),x=r(M),S=r(x),Gt=r(S,!0);a(S);var ut=n(S,2),Kt=r(ut,!0);a(ut),a(x);var mt=n(x,2),K=r(mt),Qt=r(K,!0);a(K);var Q=n(K,2),Rt=r(Q,!0);a(Q),a(mt),a(M),a(h),I((Ut,Wt)=>{p(Gt,(t(l),d(()=>t(l).invoiceNumber))),p(Kt,Ut),p(Qt,Wt),U(Q,1,`text-xs ${t(l),d(()=>t(l).paymentStatus==="paid"?"text-green-600":"text-red-600")??""}`),p(Rt,(t(l),d(()=>t(l).paymentStatus==="paid"?"已付款":"未付款")))},[()=>(t(l),d(()=>kt(t(l).date))),()=>(t(l),d(()=>Y(t(l).totalAmount)))]),_("click",h,()=>It(t(l).id)),m(v,h)}),a(i),m(s,i)};k(qt,s=>{t(w),d(()=>t(w).length===0)?s(Et):s(Ft,!1)})}a(dt),a(D),I((s,i)=>{p(At,(t(e),d(()=>t(e).name))),U(E,1,`text-lg font-bold ${s??""}`),p(Dt,i),U(B,1,`${t(e),d(()=>t(e).isActive?"bg-red-500 hover:bg-red-600":"bg-gray-500 hover:bg-gray-600")??""} text-white p-3 rounded-lg font-medium transition-colors`),p(Lt,(t(e),d(()=>t(e).isActive?"禁用":"启用"))),p(Pt,`排序 ${t(V)==="date"?t(A)==="asc"?"↑":"↓":""}`)},[()=>d(()=>X()>0?"text-red-600":"text-green-600"),()=>d(()=>Y(X()))]),_("click",lt,wt),_("click",B,Ct),_("click",N,()=>et("date")),_("click",Tt,()=>et("amount")),m(C,j)};k(u,C=>{t(e)?C($t,!1):C(b)},!0)}m(o,c)};k(jt,o=>{t(J)?o(Mt):o(St,!1)})}m(ft,at),ae(),xt()}export{De as component};
