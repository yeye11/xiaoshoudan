import"../chunks/Bzak7iHL.js";import{i as ce}from"../chunks/BvNKmLqF.js";import{p as de,m as B,o as ue,f as p,a as ve,t as y,g as t,e as c,b as v,c as pe,i as n,s as i,d as u,k as m,r as s,n as St,z as ge,j as k,v as T}from"../chunks/D2QV5ZPr.js";import{i as j}from"../chunks/BvOdW7jM.js";import{e as J,i as L}from"../chunks/IKNvqO1Y.js";import{r as A}from"../chunks/CdHOzu_t.js";import{s as P}from"../chunks/Baws9BAC.js";import{b as U}from"../chunks/fy4Fdf6-.js";import{b as be}from"../chunks/BHMMJb8Y.js";import{M as fe}from"../chunks/DO-NYQEs.js";import{g as me,h as at,i as st}from"../chunks/BFtLDb_d.js";import{g as jt}from"../chunks/BqcfPq16.js";var xe=p('<div slot="actions"><button class="p-2 rounded-lg hover:bg-black hover:bg-opacity-10 transition-colors disabled:opacity-50" aria-label="保存"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button></div>'),ye=p('<div class="bg-red-50 border border-red-200 rounded-lg p-3"><p class="text-red-600 text-sm"> </p></div>'),_e=p('<p class="text-red-500 text-sm mt-1"> </p>'),he=p('<p class="text-red-500 text-sm mt-1"> </p>'),we=p('<p class="text-red-500 text-sm"> </p>'),ke=p('<button type="button" class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>'),Se=p('<div class="flex items-center space-x-2"><input type="text" placeholder="如: 1220*2440" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/> <button type="button">默认</button> <!></div>'),je=p('<p class="text-red-500 text-sm"> </p>'),Me=p('<button type="button" class="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>'),Ce=p('<div class="flex items-center space-x-2"><select class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"><option>销售价</option><option>采购价</option><option>批发价</option></select> <input type="number" placeholder="0.00" step="0.01" min="0" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/> <button type="button">默认</button> <!></div>'),De=p('<span class="inline-flex items-center bg-gray-100 text-gray-700 text-sm px-3 py-1 rounded-full"> <button type="button" class="ml-2 text-gray-400 hover:text-gray-600"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></span>'),Be=p('<div class="flex flex-wrap gap-2"></div>'),Oe=p('<p class="text-gray-500 text-sm">暂无标签</p>'),Pe=p('<button class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors"> </button>'),$e=p('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择产品分类</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4 space-y-2"><!> <button class="w-full text-left p-3 rounded-lg text-orange-500 hover:bg-orange-50 transition-colors">+ 添加新分类</button></div></div></div>'),Ne=p('<button class="p-3 text-center rounded-lg hover:bg-gray-100 transition-colors border"> </button>'),Ie=p('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end"><div class="bg-white w-full rounded-t-lg max-h-96 overflow-y-auto"><div class="p-4 border-b border-gray-200"><div class="flex items-center justify-between"><h3 class="text-lg font-medium">选择单位</h3> <button class="text-gray-400 hover:text-gray-600"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <div class="p-4 grid grid-cols-3 gap-2"><!> <button class="p-3 text-center rounded-lg text-orange-500 hover:bg-orange-50 transition-colors border border-orange-200">+ 新单位</button></div></div></div>'),Je=p('<!> <div class="p-4 space-y-6"><!> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><h3 class="font-medium text-gray-900">基本信息</h3> <div><label class="block text-sm font-medium text-gray-700 mb-1">名称 <span class="text-red-500">*</span></label> <input type="text" placeholder="请输入产品名称"/> <!></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">条形码</label> <div class="flex space-x-2"><input type="text" placeholder="请输入条形码" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"/> <button type="button" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">生成</button></div></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">产品分类</label> <button type="button" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-left focus:ring-2 focus:ring-orange-500 focus:border-transparent flex items-center justify-between"><span> </span> <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div> <div><label class="block text-sm font-medium text-gray-700 mb-1">单位</label> <button type="button"><span> </span> <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">规格型号</h3> <button type="button" class="text-orange-500 text-sm font-medium">+ 添加</button></div> <!> <div class="space-y-3"></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">价格管理</h3> <div class="flex space-x-2"><button type="button" class="text-orange-500 text-sm font-medium">+ 销售价</button> <button type="button" class="text-orange-500 text-sm font-medium">+ 采购价</button></div></div> <!> <div class="space-y-3"></div></div> <div class="bg-white rounded-lg p-4 shadow-sm border space-y-4"><div class="flex items-center justify-between"><h3 class="font-medium text-gray-900">标签</h3> <button type="button" class="text-orange-500 text-sm font-medium">+ 添加</button></div> <!></div> <div class="bg-white rounded-lg p-4 shadow-sm border"><label class="block text-sm font-medium text-gray-700 mb-1">备注</label> <textarea placeholder="请输入备注信息" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none"></textarea></div> <div class="flex space-x-3 pb-6"><button type="button" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">取消</button> <button type="button" class="flex-1 bg-orange-500 text-white py-3 rounded-lg font-medium hover:bg-orange-600 transition-colors disabled:opacity-50"> </button></div></div> <!> <!>',1);function Qe(Mt,Ct){de(Ct,!1);let r=B(me()),d=B({}),O=B(!1),$=B(!1),N=B(!1),M=B(["未分类","装饰材料","建筑材料","五金配件"]),C=B(["件","个","套","米","平方米","立方米","吨","公斤","盒","包"]);ue(()=>{Dt(),t(r).specifications.length===0&&t(r).specifications.push(at()),t(r).prices.length===0&&t(r).prices.push(st("sale"))});const Dt=()=>{try{const e=localStorage.getItem("product_categories");if(e){const a=JSON.parse(e);m(M,[...new Set([...t(M),...a])])}const o=localStorage.getItem("product_units");if(o){const a=JSON.parse(o);m(C,[...new Set([...t(C),...a])])}}catch(e){console.error("加载选项数据失败:",e)}},Bt=()=>{try{localStorage.setItem("product_categories",JSON.stringify(t(M))),localStorage.setItem("product_units",JSON.stringify(t(C)))}catch(e){console.error("保存选项数据失败:",e)}},Ot=()=>(m(d,{}),t(r).name.trim()||u(d,t(d).name="产品名称不能为空"),Object.keys(t(d)).length===0),it=async()=>{if(Ot()){m(O,!0);try{u(r,t(r).name=t(r).name.trim()),u(r,t(r).specifications=t(r).specifications.filter(a=>a.name.trim())),u(r,t(r).prices=t(r).prices.filter(a=>a.price>0)),t(r).specifications.length===0?t(r).specifications.push({...at(),name:"默认规格",isDefault:!0}):t(r).specifications.some(a=>a.isDefault)||u(r,t(r).specifications[0].isDefault=!0),t(r).prices.length===0?t(r).prices.push({...st("sale"),price:0,isDefault:!0}):t(r).prices.some(a=>a.isDefault)||u(r,t(r).prices[0].isDefault=!0),t(r).unit.trim()||u(r,t(r).unit="件"),t(r).category.trim()||u(r,t(r).category="未分类");const e=localStorage.getItem("products"),o=e?JSON.parse(e):[];if(o.some(a=>a.name===t(r).name)){u(d,t(d).name="产品名称已存在"),m(O,!1);return}u(r,t(r).updatedAt=new Date().toISOString()),o.push(t(r)),localStorage.setItem("products",JSON.stringify(o)),t(r).category&&!t(M).includes(t(r).category)&&t(M).push(t(r).category),t(r).unit&&!t(C).includes(t(r).unit)&&t(C).push(t(r).unit),Bt(),jt("/mobile/products")}catch(e){console.error("保存产品失败:",e),u(d,t(d).general="保存失败，请重试")}finally{m(O,!1)}}},Pt=e=>{u(r,t(r).category=e),m($,!1)},$t=e=>{u(r,t(r).unit=e),m(N,!1)},Nt=()=>{const e=prompt("请输入新的产品分类:");if(e&&e.trim()){const o=e.trim();t(M).includes(o)||t(M).push(o),u(r,t(r).category=o)}m($,!1)},It=()=>{const e=prompt("请输入新的单位:");if(e&&e.trim()){const o=e.trim();t(C).includes(o)||t(C).push(o),u(r,t(r).unit=o)}m(N,!1)},Jt=()=>{t(r).specifications.push(at())},Lt=e=>{t(r).specifications.length>1&&t(r).specifications.splice(e,1)},Ut=e=>{t(r).specifications.forEach((o,a)=>{o.isDefault=a===e})},nt=(e="sale")=>{t(r).prices.push(st(e))},Et=e=>{t(r).prices.length>1&&t(r).prices.splice(e,1)},zt=e=>{const o=t(r).prices[e].type;t(r).prices.forEach((a,l)=>{a.type===o&&(a.isDefault=l===e)})},Tt=()=>{const e=prompt("请输入标签:");e&&e.trim()&&!t(r).tags.includes(e.trim())&&t(r).tags.push(e.trim())},At=e=>{t(r).tags.splice(e,1)},Ht=()=>{const e=Date.now().toString(),o=Math.random().toString(36).substr(2,5);u(r,t(r).barcode=`${e.slice(-8)}${o}`.toUpperCase())};ce();var lt=Je(),ct=ve(lt);fe(ct,{title:"新建产品",showBack:!0,backgroundColor:"bg-orange-500",$$slots:{actions:(e,o)=>{var a=xe(),l=n(a);s(a),y(()=>l.disabled=t(O)),c("click",l,it),v(e,a)}}});var H=i(ct,2),dt=n(H);{var Vt=e=>{var o=ye(),a=n(o),l=n(a,!0);s(a),s(o),y(()=>k(l,t(d).general)),v(e,o)};j(dt,e=>{t(d).general&&e(Vt)})}var V=i(dt,2),F=i(n(V),2),E=i(n(F),2);A(E);var Ft=i(E,2);{var qt=e=>{var o=_e(),a=n(o,!0);s(o),y(()=>k(a,t(d).name)),v(e,o)};j(Ft,e=>{t(d).name&&e(qt)})}s(F);var q=i(F,2),ut=i(n(q),2),G=n(ut);A(G);var Gt=i(G,2);s(ut),s(q);var K=i(q,2),Q=i(n(K),2),R=n(Q),Kt=n(R,!0);s(R),St(2),s(Q),s(K);var vt=i(K,2),I=i(n(vt),2),W=n(I),Qt=n(W,!0);s(W),St(2),s(I);var Rt=i(I,2);{var Wt=e=>{var o=he(),a=n(o,!0);s(o),y(()=>k(a,t(d).unit)),v(e,o)};j(Rt,e=>{t(d).unit&&e(Wt)})}s(vt),s(V);var X=i(V,2),Y=n(X),Xt=i(n(Y),2);s(Y);var pt=i(Y,2);{var Yt=e=>{var o=we(),a=n(o,!0);s(o),y(()=>k(a,t(d).specifications)),v(e,o)};j(pt,e=>{t(d).specifications&&e(Yt)})}var gt=i(pt,2);J(gt,5,()=>t(r).specifications,L,(e,o,a)=>{var l=Se(),g=n(l);A(g);var b=i(g,2),f=i(b,2);{var _=x=>{var S=ke();c("click",S,()=>Lt(a)),v(x,S)};j(f,x=>{t(r).specifications.length>1&&x(_)})}s(l),y(()=>P(b,1,`px-3 py-2 text-sm rounded-lg transition-colors
                   ${t(o).isDefault?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`)),U(g,()=>t(o).name,x=>(t(o).name=x,T(()=>t(r)))),c("click",b,()=>Ut(a)),v(e,l)}),s(gt),s(X);var Z=i(X,2),tt=n(Z),bt=i(n(tt),2),ft=n(bt),Zt=i(ft,2);s(bt),s(tt);var mt=i(tt,2);{var te=e=>{var o=je(),a=n(o,!0);s(o),y(()=>k(a,t(d).prices)),v(e,o)};j(mt,e=>{t(d).prices&&e(te)})}var xt=i(mt,2);J(xt,5,()=>t(r).prices,L,(e,o,a)=>{var l=Ce(),g=n(l);y(()=>{t(o),T(()=>{})});var b=n(g);b.value=b.__value="sale";var f=i(b);f.value=f.__value="purchase";var _=i(f);_.value=_.__value="wholesale",s(g);var x=i(g,2);A(x);var S=i(x,2),D=i(S,2);{var h=w=>{var kt=Me();c("click",kt,()=>Et(a)),v(w,kt)};j(D,w=>{t(r).prices.length>1&&w(h)})}s(l),y(()=>P(S,1,`px-3 py-2 text-sm rounded-lg transition-colors
                   ${t(o).isDefault?"bg-orange-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`)),be(g,()=>t(o).type,w=>(t(o).type=w,T(()=>t(r)))),U(x,()=>t(o).price,w=>(t(o).price=w,T(()=>t(r)))),c("click",S,()=>zt(a)),v(e,l)}),s(xt),s(Z);var et=i(Z,2),rt=n(et),ee=i(n(rt),2);s(rt);var re=i(rt,2);{var oe=e=>{var o=Be();J(o,5,()=>t(r).tags,L,(a,l,g)=>{var b=De(),f=n(b),_=i(f);s(b),y(()=>k(f,`${t(l)??""} `)),c("click",_,()=>At(g)),v(a,b)}),s(o),v(e,o)},ae=e=>{var o=Oe();v(e,o)};j(re,e=>{t(r).tags.length>0?e(oe):e(ae,!1)})}s(et);var ot=i(et,2),yt=i(n(ot),2);ge(yt),s(ot);var _t=i(ot,2),ht=n(_t),z=i(ht,2),se=n(z,!0);s(z),s(_t),s(H);var wt=i(H,2);{var ie=e=>{var o=$e(),a=n(o),l=n(a),g=n(l),b=i(n(g),2);s(g),s(l);var f=i(l,2),_=n(f);J(_,1,()=>t(M),L,(S,D)=>{var h=Pe(),w=n(h,!0);s(h),y(()=>k(w,t(D))),c("click",h,()=>Pt(t(D))),v(S,h)});var x=i(_,2);s(f),s(a),s(o),c("click",b,()=>m($,!1)),c("click",x,Nt),v(e,o)};j(wt,e=>{t($)&&e(ie)})}var ne=i(wt,2);{var le=e=>{var o=Ie(),a=n(o),l=n(a),g=n(l),b=i(n(g),2);s(g),s(l);var f=i(l,2),_=n(f);J(_,1,()=>t(C),L,(S,D)=>{var h=Ne(),w=n(h,!0);s(h),y(()=>k(w,t(D))),c("click",h,()=>$t(t(D))),v(S,h)});var x=i(_,2);s(f),s(a),s(o),c("click",b,()=>m(N,!1)),c("click",x,It),v(e,o)};j(ne,e=>{t(N)&&e(le)})}y(()=>{P(E,1,`w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent
               ${t(d).name?"border-red-500":""}`),P(R,1,t(r).category?"text-gray-900":"text-gray-500"),k(Kt,t(r).category||"请选择产品分类"),P(I,1,`w-full px-3 py-2 border border-gray-300 rounded-lg text-left focus:ring-2 focus:ring-orange-500 focus:border-transparent flex items-center justify-between
               ${t(d).unit?"border-red-500":""}`),P(W,1,t(r).unit?"text-gray-900":"text-gray-500"),k(Qt,t(r).unit||"请选择单位"),z.disabled=t(O),k(se,t(O)?"保存中...":"保存")}),U(E,()=>t(r).name,e=>u(r,t(r).name=e)),U(G,()=>t(r).barcode,e=>u(r,t(r).barcode=e)),c("click",Gt,Ht),c("click",Q,()=>m($,!0)),c("click",I,()=>m(N,!0)),c("click",Xt,Jt),c("click",ft,()=>nt("sale")),c("click",Zt,()=>nt("purchase")),c("click",ee,Tt),U(yt,()=>t(r).notes,e=>u(r,t(r).notes=e)),c("click",ht,()=>jt("/mobile/products")),c("click",z,it),v(Mt,lt),pe()}export{Qe as component};
